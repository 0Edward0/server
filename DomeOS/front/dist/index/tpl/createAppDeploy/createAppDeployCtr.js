'use strict';

(function (domeApp, undefined) {
	'use strict';

	if (typeof domeApp === 'undefined') return;
	domeApp.controller('CreateAppDeployCtr', ['$scope', '$domeAppStore', '$domeCluster', '$domeUser', '$state', '$stateParams', '$domePublic', function ($scope, $domeAppStore, $domeCluster, $domeUser, $state, $stateParams, $domePublic) {
		if (!$stateParams.appName) {
			$state.go('appStore');
		}
		$scope.$emit('pageTitle', {
			title: $stateParams.appName,
			descrition: '',
			mod: 'appStore'
		});
		var appData = void 0;
		var nodeService = $domeCluster.getInstance('NodeService');
		$domeAppStore.getStoreApps().then(function (res) {
			var isExist = false;
			if (res.data) {
				for (var i = 0, l = res.data.length; i < l; i++) {
					if (res.data[i].appName === $stateParams.appName) {
						isExist = true;
						appData = res.data[i];
						break;
					}
				}
				if (!isExist) {
					$domePublic.openWarning('无相关应用数据');
					$state.go('appStore');
				} else {
					var logDraft = {
						logItemDrafts: []
					};
					var logPathList = appData.deploymentTemplate.logPathList;
					if (!logPathList) {
						logPathList = [];
					}
					for (var j = 0, l1 = logPathList.length; j < l1; j++) {
						logDraft.logItemDrafts.push({
							logPath: logPathList[j],
							autoCollect: false,
							autoDelete: false
						});
					}
					appData.deploymentTemplate.logPathList = void 0;
					// 转换为部署需要的日志格式
					appData.deploymentTemplate.logDraft = logDraft;
					appData.deploymentTemplate.networkMode = 'DEFAULT';
					$scope.appInfoIns = $domeAppStore.getInstance('AppInfo', appData);
					$scope.config = $scope.appInfoIns.config;
					$scope.deployIns = $scope.appInfoIns.deployIns;
					$scope.deployConfig = $scope.deployIns.config;
					nodeService.getData().then(function (res) {
						$scope.deployIns.clusterListIns.init(res.data.result);
						$scope.deployIns.toggleCluster();
					});
					// $domeUser.userService.getGroupList().then(function(res) {
					// 	$scope.deployIns.userGroupListIns.init(res.data.result);
					// }).finally(function() {});
				}
			} else {
					$domePublic.openWarning('请求失败！');
					$state.go('appStore');
				}
		}, function () {
			$domePublic.openWarning('请求失败！');
			$state.go('appStore');
		});

		$scope.createDeploy = function () {
			$scope.isLoading = true;
			$scope.deployIns.create().then(function () {
				$domePublic.openPrompt('创建成功！');
				$state.go('deployManage');
			}, function (res) {
				if (res.type == 'namespace') {
					$domePublic.openWarning({
						title: '创建namespace失败！',
						msg: 'Msg:' + res.msg
					});
				} else {
					$domePublic.openWarning({
						title: '创建失败！',
						msg: 'Msg:' + res.msg
					});
				}
			}).finally(function () {
				$scope.isLoading = false;
			});
		};
	}]);
})(window.domeApp);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4L3RwbC9jcmVhdGVBcHBEZXBsb3kvY3JlYXRlQXBwRGVwbG95Q3RyLmVzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsQ0FBQyxVQUFVLE9BQVYsRUFBbUIsU0FBbkIsRUFBOEI7QUFDOUIsY0FEOEI7O0FBRTlCLEtBQUksT0FBTyxPQUFQLEtBQW1CLFdBQW5CLEVBQWdDLE9BQXBDO0FBQ0EsU0FBUSxVQUFSLENBQW1CLG9CQUFuQixFQUF5QyxDQUFDLFFBQUQsRUFBVyxlQUFYLEVBQTRCLGNBQTVCLEVBQTRDLFdBQTVDLEVBQXlELFFBQXpELEVBQW1FLGNBQW5FLEVBQW1GLGFBQW5GLEVBQWtHLFVBQVUsTUFBVixFQUFrQixhQUFsQixFQUFpQyxZQUFqQyxFQUErQyxTQUEvQyxFQUEwRCxNQUExRCxFQUFrRSxZQUFsRSxFQUFnRixXQUFoRixFQUE2RjtBQUN2TyxNQUFJLENBQUMsYUFBYSxPQUFiLEVBQXNCO0FBQzFCLFVBQU8sRUFBUCxDQUFVLFVBQVYsRUFEMEI7R0FBM0I7QUFHQSxTQUFPLEtBQVAsQ0FBYSxXQUFiLEVBQTBCO0FBQ3pCLFVBQU8sYUFBYSxPQUFiO0FBQ1AsZUFBWSxFQUFaO0FBQ0EsUUFBSyxVQUFMO0dBSEQsRUFKdU87QUFTdk8sTUFBSSxnQkFBSixDQVR1TztBQVV2TyxNQUFNLGNBQWMsYUFBYSxXQUFiLENBQXlCLGFBQXpCLENBQWQsQ0FWaU87QUFXdk8sZ0JBQWMsWUFBZCxHQUE2QixJQUE3QixDQUFrQyxVQUFVLEdBQVYsRUFBZTtBQUNoRCxPQUFJLFVBQVUsS0FBVixDQUQ0QztBQUVoRCxPQUFJLElBQUksSUFBSixFQUFVO0FBQ2IsU0FBSyxJQUFJLElBQUksQ0FBSixFQUFPLElBQUksSUFBSSxJQUFKLENBQVMsTUFBVCxFQUFpQixJQUFJLENBQUosRUFBTyxHQUE1QyxFQUFpRDtBQUNoRCxTQUFJLElBQUksSUFBSixDQUFTLENBQVQsRUFBWSxPQUFaLEtBQXdCLGFBQWEsT0FBYixFQUFzQjtBQUNqRCxn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L3RwbC9jcmVhdGVBcHBEZXBsb3kvY3JlYXRlQXBwRGVwbG95Q3RyLmpzIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIChkb21lQXBwLCB1bmRlZmluZWQpIHtcblx0J3VzZSBzdHJpY3QnO1xuXHRpZiAodHlwZW9mIGRvbWVBcHAgPT09ICd1bmRlZmluZWQnKSByZXR1cm47XG5cdGRvbWVBcHAuY29udHJvbGxlcignQ3JlYXRlQXBwRGVwbG95Q3RyJywgWyckc2NvcGUnLCAnJGRvbWVBcHBTdG9yZScsICckZG9tZUNsdXN0ZXInLCAnJGRvbWVVc2VyJywgJyRzdGF0ZScsICckc3RhdGVQYXJhbXMnLCAnJGRvbWVQdWJsaWMnLCBmdW5jdGlvbiAoJHNjb3BlLCAkZG9tZUFwcFN0b3JlLCAkZG9tZUNsdXN0ZXIsICRkb21lVXNlciwgJHN0YXRlLCAkc3RhdGVQYXJhbXMsICRkb21lUHVibGljKSB7XG5cdFx0aWYgKCEkc3RhdGVQYXJhbXMuYXBwTmFtZSkge1xuXHRcdFx0JHN0YXRlLmdvKCdhcHBTdG9yZScpO1xuXHRcdH1cblx0XHQkc2NvcGUuJGVtaXQoJ3BhZ2VUaXRsZScsIHtcblx0XHRcdHRpdGxlOiAkc3RhdGVQYXJhbXMuYXBwTmFtZSxcblx0XHRcdGRlc2NyaXRpb246ICcnLFxuXHRcdFx0bW9kOiAnYXBwU3RvcmUnXG5cdFx0fSk7XG5cdFx0bGV0IGFwcERhdGE7XG5cdFx0Y29uc3Qgbm9kZVNlcnZpY2UgPSAkZG9tZUNsdXN0ZXIuZ2V0SW5zdGFuY2UoJ05vZGVTZXJ2aWNlJyk7XG5cdFx0JGRvbWVBcHBTdG9yZS5nZXRTdG9yZUFwcHMoKS50aGVuKGZ1bmN0aW9uIChyZXMpIHtcblx0XHRcdGxldCBpc0V4aXN0ID0gZmFsc2U7XG5cdFx0XHRpZiAocmVzLmRhdGEpIHtcblx0XHRcdFx0Zm9yIChsZXQgaSA9IDAsIGwgPSByZXMuZGF0YS5sZW5ndGg7IGkgPCBsOyBpKyspIHtcblx0XHRcdFx0XHRpZiAocmVzLmRhdGFbaV0uYXBwTmFtZSA9PT0gJHN0YXRlUGFyYW1zLmFwcE5hbWUpIHtcblx0XHRcdFx0XHRcdGlzRXhpc3QgPSB0cnVlO1xuXHRcdFx0XHRcdFx0YXBwRGF0YSA9IHJlcy5kYXRhW2ldO1xuXHRcdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHRcdGlmICghaXNFeGlzdCkge1xuXHRcdFx0XHRcdCRkb21lUHVibGljLm9wZW5XYXJuaW5nKCfml6Dnm7jlhbPlupTnlKjmlbDmja4nKTtcblx0XHRcdFx0XHQkc3RhdGUuZ28oJ2FwcFN0b3JlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0bGV0IGxvZ0RyYWZ0ID0ge1xuXHRcdFx0XHRcdFx0bG9nSXRlbURyYWZ0czogW11cblx0XHRcdFx0XHR9O1xuXHRcdFx0XHRcdGxldCBsb2dQYXRoTGlzdCA9IGFwcERhdGEuZGVwbG95bWVudFRlbXBsYXRlLmxvZ1BhdGhMaXN0O1xuXHRcdFx0XHRcdGlmICghbG9nUGF0aExpc3QpIHtcblx0XHRcdFx0XHRcdGxvZ1BhdGhMaXN0ID0gW107XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGZvciAobGV0IGogPSAwLCBsMSA9IGxvZ1BhdGhMaXN0Lmxlbmd0aDsgaiA8IGwxOyBqKyspIHtcblx0XHRcdFx0XHRcdGxvZ0RyYWZ0LmxvZ0l0ZW1EcmFmdHMucHVzaCh7XG5cdFx0XHRcdFx0XHRcdGxvZ1BhdGg6IGxvZ1BhdGhMaXN0W2pdLFxuXHRcdFx0XHRcdFx0XHRhdXRvQ29sbGVjdDogZmFsc2UsXG5cdFx0XHRcdFx0XHRcdGF1dG9EZWxldGU6IGZhbHNlXG5cdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0YXBwRGF0YS5kZXBsb3ltZW50VGVtcGxhdGUubG9nUGF0aExpc3QgPSB2b2lkIDA7XG5cdFx0XHRcdFx0Ly8g6L2s5o2i5Li66YOo572y6ZyA6KaB55qE5pel5b+X5qC85byPXG5cdFx0XHRcdFx0YXBwRGF0YS5kZXBsb3ltZW50VGVtcGxhdGUubG9nRHJhZnQgPSBsb2dEcmFmdDtcblx0XHRcdFx0XHRhcHBEYXRhLmRlcGxveW1lbnRUZW1wbGF0ZS5uZXR3b3JrTW9kZSA9ICdERUZBVUxUJztcblx0XHRcdFx0XHQkc2NvcGUuYXBwSW5mb0lucyA9ICRkb21lQXBwU3RvcmUuZ2V0SW5zdGFuY2UoJ0FwcEluZm8nLCBhcHBEYXRhKTtcblx0XHRcdFx0XHQkc2NvcGUuY29uZmlnID0gJHNjb3BlLmFwcEluZm9JbnMuY29uZmlnO1xuXHRcdFx0XHRcdCRzY29wZS5kZXBsb3lJbnMgPSAkc2NvcGUuYXBwSW5mb0lucy5kZXBsb3lJbnM7XG5cdFx0XHRcdFx0JHNjb3BlLmRlcGxveUNvbmZpZyA9ICRzY29wZS5kZXBsb3lJbnMuY29uZmlnO1xuXHRcdFx0XHRcdG5vZGVTZXJ2aWNlLmdldERhdGEoKS50aGVuKGZ1bmN0aW9uIChyZXMpIHtcblx0XHRcdFx0XHRcdCRzY29wZS5kZXBsb3lJbnMuY2x1c3Rlckxpc3RJbnMuaW5pdChyZXMuZGF0YS5yZXN1bHQpO1xuXHRcdFx0XHRcdFx0JHNjb3BlLmRlcGxveUlucy50b2dnbGVDbHVzdGVyKCk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0Ly8gJGRvbWVVc2VyLnVzZXJTZXJ2aWNlLmdldEdyb3VwTGlzdCgpLnRoZW4oZnVuY3Rpb24ocmVzKSB7XG5cdFx0XHRcdFx0Ly8gXHQkc2NvcGUuZGVwbG95SW5zLnVzZXJHcm91cExpc3RJbnMuaW5pdChyZXMuZGF0YS5yZXN1bHQpO1xuXHRcdFx0XHRcdC8vIH0pLmZpbmFsbHkoZnVuY3Rpb24oKSB7fSk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCRkb21lUHVibGljLm9wZW5XYXJuaW5nKCfor7fmsYLlpLHotKXvvIEnKTtcblx0XHRcdFx0JHN0YXRlLmdvKCdhcHBTdG9yZScpO1xuXHRcdFx0fVxuXHRcdH0sIGZ1bmN0aW9uICgpIHtcblx0XHRcdCRkb21lUHVibGljLm9wZW5XYXJuaW5nKCfor7fmsYLlpLHotKXvvIEnKTtcblx0XHRcdCRzdGF0ZS5nbygnYXBwU3RvcmUnKTtcblx0XHR9KTtcblxuXHRcdCRzY29wZS5jcmVhdGVEZXBsb3kgPSBmdW5jdGlvbiAoKSB7XG5cdFx0XHQkc2NvcGUuaXNMb2FkaW5nID0gdHJ1ZTtcblx0XHRcdCRzY29wZS5kZXBsb3lJbnMuY3JlYXRlKCkudGhlbihmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdCRkb21lUHVibGljLm9wZW5Qcm9tcHQoJ+WIm+W7uuaIkOWKn++8gScpO1xuXHRcdFx0XHQkc3RhdGUuZ28oJ2RlcGxveU1hbmFnZScpO1xuXHRcdFx0fSwgZnVuY3Rpb24gKHJlcykge1xuXHRcdFx0XHRpZiAocmVzLnR5cGUgPT0gJ25hbWVzcGFjZScpIHtcblx0XHRcdFx0XHQkZG9tZVB1YmxpYy5vcGVuV2FybmluZyh7XG5cdFx0XHRcdFx0XHR0aXRsZTogJ+WIm+W7um5hbWVzcGFjZeWksei0pe+8gScsXG5cdFx0XHRcdFx0XHRtc2c6ICdNc2c6JyArIHJlcy5tc2dcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHQkZG9tZVB1YmxpYy5vcGVuV2FybmluZyh7XG5cdFx0XHRcdFx0XHR0aXRsZTogJ+WIm+W7uuWksei0pe+8gScsXG5cdFx0XHRcdFx0XHRtc2c6ICdNc2c6JyArIHJlcy5tc2dcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fSkuZmluYWxseShmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdCRzY29wZS5pc0xvYWRpbmcgPSBmYWxzZTtcblx0XHRcdH0pO1xuXHRcdH07XG5cdH1dKTtcbn0pKHdpbmRvdy5kb21lQXBwKTsiXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
