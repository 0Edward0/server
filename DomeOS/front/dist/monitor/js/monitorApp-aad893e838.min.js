function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}!function(e,t){"use strict";var n=angular.module("amchartsModule",[]);n.directive("amchart",function(){return{replace:!0,scope:{options:"=ngModel",type:"@"},template:'<div class="amchart" style="width: 100%; height: 100%;"></div>',link:function(e,t){var n=function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()},a=n();t.attr("id",a);var i,r=function(){i&&i.clear();var t=e.options,n=Object.keys(t);switch(e.type){case"serial":i=new AmCharts.AmSerialChart;break;case"pie":i=new AmCharts.AmPieChart;break;case"funnel":i=new AmCharts.AmFunnelChart;break;case"gauge":i=new AmCharts.AmAngularGauge;break;case"radar":i=new AmCharts.AmRadarChart;break;case"xy":i=new AmCharts.AmXYChart}i.dataProvider=t.data;for(var r=0,o=n.length;o>r;r++)"object"!=typeof t[n[r]]&&"function"!=typeof t[n[r]]?i[n[r]]=t[n[r]]:i[n[r]]=angular.copy(t[n[r]]);i.write(a)};r(e.options),e.$watch("options",function(e){a!==t[0].id&&a||r(e)},!0)}}}),e.amchartsApp=n}(window);var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}();!function(e,t){var n=angular.module("publicModule",[]);n.service("$util",["$q",function(t){"use strict";var n=function(e){return"[object Array]"===Object.prototype.toString.call(e)},a=function(e){return"[object Object]"===Object.prototype.toString.call(e)},i=function(e){if(a(e)){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}},r=function(t){var n=new RegExp("(^|&)"+t+"=([^&]*)(&|$)","i"),a=e.location.search.substr(1).match(n);return null!==a?unescape(a[2]):null},o=function(e,t){return null===e||isNaN(e)?void 0:+parseFloat(e).toFixed(t)},s=function(e,t){if(null!==e&&!isNaN(e)){switch(t){case"MB":e=(+e/1024/1024).toFixed(2);break;case"GB":e=(+e/1024/1024/1024).toFixed(2);break;case"KB":e=(+e/1024).toFixed(2);break;default:e=e.toFixed(2)}return+e}},l=function(e,t){for(var n=void 0,a=new RegExp("{#([a-zA-z0-9]+)}");null!==(n=a.exec(e));){var i=0===t[n[1]]?"0":t[n[1]]||"";e=e.replace(new RegExp(n[0],"g"),i)}return e},u=function(e){return a(e)?Object.keys(e).length:0},c=function(e,t){e=new Date(e),e.setDate(e.getDate()+t);var n=e.getFullYear(),a=e.getMonth()+1,i=e.getDate();return 10>a&&(a="0"+a),10>i&&(i="0"+i),n+"-"+a+"-"+i},d=function(e,t,n){var a={};"undefined"==typeof t&&(t=(new Date).getTime());var i=t-e;return a.day=Math.floor(i/864e5),i-=24*a.day*3600*1e3,a.hours=Math.floor(i/36e5),i-=3600*a.hours*1e3,a.mimutes=Math.floor(i/6e4),n&&(i-=60*a.mimutes*1e3,a.seconds=Math.floor(i/1e3)),a},m=function(e,t){var n="",a=void 0;return!e||!t||0>=t-e?n="0秒":(a=d(e,t,!0),0!==a.day&&(n+=a.day+"天"),0!==a.hours&&(n+=a.hours+"小时"),0!==a.mimutes&&(n+=a.mimutes+"分钟"),0!==a.seconds&&(n+=a.seconds+"秒"),""===n&&(n="0秒")),n},f=function(e,t,n){if(!e&&!t||0>=e-t)return"无";var a=d(e,t,n),i=a.day,r=a.hours,o=a.mimutes,s=void 0;return s=0>i||0>r||0>o?"刚刚":i>60?"更早":i>30?"一个月前":i>3?i+"天前":3==i?"三天前":2==i?"两天前":1==i?"昨天":r>=1?r+"小时前":0===o?"刚刚":o+"分钟前"},p=function(e){var n=t.defer();return $.getScript(e,function(){n.resolve()}),n.promise};return{isEmptyObject:i,isArray:n,isObject:a,parseTpl:l,toDecimal:o,formartBytesData:s,getQueryString:r,objLength:u,calculateDate:c,getPageInterval:m,getDateInterval:d,getPageDate:f,loadJs:p}}]).factory("$domeModel",["$http",function(e){"use strict";var n=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),a=1;t>a;a++)n[a-1]=arguments[a];for(var i=e,r=[].concat(n),o=0,s=r.length;s>o;o++)i+="/"+r[o];return i},a=function(){function e(t){_classCallCheck(this,e),this.selectListName=t?t:"selectList",this.isCheckAll=!1,this.selectedCount=0,this[this.selectListName]=[]}return _createClass(e,[{key:"init",value:function(e,n){var a=this;this.isCheckAll=!1,this.selectedCount=0,this[this.selectListName]=function(){if(e&&0!==e.length){if("[object Object]"===Object.prototype.toString.call(e[0])){var i=!0,r=!1,o=t;try{for(var s,l=e[Symbol.iterator]();!(i=(s=l.next()).done);i=!0){var u=s.value;u.keyFilter=!0,"undefined"!=typeof n&&(u.isSelected=n),u.isSelected&&a.selectedCount++}}catch(c){r=!0,o=c}finally{try{!i&&l["return"]&&l["return"]()}finally{if(r)throw o}}}else for(var d=0,m=e.length;m>d;d++)e[d]={item:e[d],keyFilter:!0,isSelected:n},"undefined"!=typeof n&&(e[d].isSelected=n),e[d].isSelected&&a.selectedCount++;return a.selectedCount===e.length&&(a.isCheckAll=!0),e}return[]}()}},{key:"toggleCheck",value:function(e,n){var a=!0;if(e.isSelected=n,n){this.selectedCount++;var i=this[this.selectListName],r=!0,o=!1,s=t;try{for(var l,u=i[Symbol.iterator]();!(r=(l=u.next()).done);r=!0){var c=l.value;if(c.keyFilter&&!c.isSelected){a=!1;break}}}catch(d){o=!0,s=d}finally{try{!r&&u["return"]&&u["return"]()}finally{if(o)throw s}}a&&(this.isCheckAll=!0)}else this.selectedCount--,this.isCheckAll=!1}},{key:"checkAllItem",value:function(e){this.isCheckAll="undefined"==typeof e?this.isCheckAll:e,this.selectedCount=0;var n=this[this.selectListName],a=!0,i=!1,r=t;try{for(var o,s=n[Symbol.iterator]();!(a=(o=s.next()).done);a=!0){var l=o.value;l.keyFilter&&this.isCheckAll?(l.isSelected=!0,this.selectedCount++):l.isSelected=!1}}catch(u){i=!0,r=u}finally{try{!a&&s["return"]&&s["return"]()}finally{if(i)throw r}}}},{key:"filterWithKey",value:function(e,n){this.isCheckAll=!1,this.selectedCount=0,"undefined"==typeof n&&(n="item");var a=this[this.selectListName];if(void 0!==a[0][n]){var i=!0,r=!1,o=t;try{for(var s,l=a[Symbol.iterator]();!(i=(s=l.next()).done);i=!0){var u=s.value;u.isSelected=!1,u.keyFilter=-1!==u[n].indexOf(e)}}catch(c){r=!0,o=c}finally{try{!i&&l["return"]&&l["return"]()}finally{if(r)throw o}}}}}]),e}(),i=function(a){this.getData=function(){for(var i=arguments.length,r=Array(i),o=0;i>o;o++)r[o]=arguments[o];return e.get(n.apply(t,[a].concat(r)))},this.setData=function(t,n){return e.post(a,t,n)},this.updateData=function(t){return e.put(a,t)},this.deleteData=function(){for(var i=arguments.length,r=Array(i),o=0;i>o;o++)r[o]=arguments[o];return e["delete"](n.apply(t,[a].concat(r)))}},r=function(e){return e||(e={}),function(t){for(var n=arguments.length,a=Array(n>1?n-1:0),i=1;n>i;i++)a[i-1]=arguments[i];var r=void 0,o=e[t];return"function"==typeof o?r=new(Function.prototype.bind.apply(o,[null].concat(a))):(r={},console.log("error:there is no "+t)),r}};return{SelectListModel:a,ServiceModel:i,instancesCreator:r}}]).provider("$domeData",function(){"use strict";var e={},t=function(t,n){e[t]=n},n=function(t){return e[t]},a=function(t){e[t]&&(e[t]=null)};return{setData:t,$get:function(){return{setData:t,getData:n,delData:a}}}}),e.publicModule=n}(window),function(e,t,n){t.directive("selectCon",function(){"use strict";return{restrict:"AEC",scope:!0,transclude:!0,replace:!0,template:"<div ng-transclude></div>",controller:["$scope",function(e){this.hideSelect=function(){e.hideSelect()}}],link:function(e,t,a){var i=t.find(".select-list"),r=t.find(".ui-btn-select"),o=t.find(".drop"),s=!1;if(0!==r.length){i.hide(),r.on("blur",u);var l=function(e){s=e!==n?e:!s,s===!0?(i.show(),o.removeClass("up")):s===!1&&(i.hide(),o.addClass("up"))},u=function(e){return l(!1),e.stopPropagation()};r.on("blur",u),i.on("mouseenter",function(){r.off("blur",u)}).on("mouseleave",function(){r.on("blur",u)}),"INPUT"===r[0].tagName?r.on("focus",function(){l(!0)}):r.on("click",function(){l()}),"true"==a.label&&(t.on("click",function(){r.focus()}),r.bind("focus",function(e){r.width(t.width()-20-r.position().left),e.stopPropagation()}).bind("blur",function(){r.width(120)})),e.hideSelect=function(){l(!1)}}}}}).directive("selectItem",["$compile",function(e){"use strict";return{restrict:"AEC",require:"^?selectCon",link:function(t,n,a,i){t.hideSelect=function(){i.hideSelect()};var r=angular.element(a.$$element.find(">a")[0]),o=r.attr("ng-click");o?o+=";hideSelect($event.stopPropagation());":o="hideSelect($event.stopPropagation())",r.attr("ng-click",o),n.html(e(n.html())(t))}}}]).directive("loading",function(){"use strict";return{restrict:"AE",template:'<div class="com-loading"><div class="dot1"></div><div class="dot2"></div></div>',replace:!0}}).directive("domeRadio",function(){"use strict";return{restrict:"E",scope:{radioModel:"=dModel",label:"@dLabel",name:"@dName",id:"@dId",disabled:"@dDisabled",value:"@dValue",changeEvent:"&dChange"},replace:!0,template:'<span><input id="{{id}}" type="radio" name="{{name}}" class="ui-radio" ng-value="{{value}}" ng-model="radioModel" ng-change="changeEvent({model:radioModel})" ng-disabled="{{disabled}}"/><label ng-bind="label" for="{{id}}"></label></span>'}}).directive("domeCheck",function(){"use strict";return{restrict:"E",scope:{checkModel:"=ngModel",label:"@dLabel",name:"@dName",id:"@dId",trueValue:"@dTrueValue",falseValue:"@dFalseValue",changeEvent:"&dChange"},replace:!0,template:'<span><input id="{{id}}" type="checkbox" name="{{name}}" class="ui-check" ng-true-value="{{trueValue||true}}"  ng-false-value="{{falseValue||false}}" ng-model="checkModel" ng-change="changeEvent({model:checkModel})" /><label ng-bind="label" for="{{id}}"></label></span>'}}),t.directive("notEqual",function(){return{restrict:"A",require:"ngModel",scope:{notEqual:"=notEqual"},link:function(e,t,a,i){i.$parsers.unshift(function(t){var a=e.notEqual===n?!1:e.notEqual.toString()===t;return i.$setValidity("notEqual",!a),t})}}}).directive("equal",function(){return{restrict:"A",require:"ngModel",scope:{equal:"=equal"},link:function(e,t,a,i){i.$parsers.unshift(function(t){var a=e.equal===n?!0:e.equal.toString()===t;return i.$setValidity("equal",a),t})}}})}(window,window.publicModule||{}),function(e){var t=angular.module("domeModule",[]);t.config(["$httpProvider",function(e){"use strict";e.defaults.headers.post["Content-Type"]="application/json;charset=UTF-8",e.interceptors.push(["$rootScope","$q",function(e,t){return{response:function(e){return"string"==typeof e.data&&e.data.indexOf('<html ng-app="loginApp">')>=0&&(-1!==e.config.url.indexOf("api/user/logout")?location.href="/login/login.html":location.href="/login/login.html?redirect="+encodeURIComponent(location.href)),e.config.notIntercept?e:e.data.resultCode&&200!=e.data.resultCode?t.reject(e):e||t.resolve(e)}}}])}]),t.controller("PromptModalCtrl",["$scope","$modalInstance","promptTxt","$timeout",function(e,t,n,a){"use strict";e.promptTxt=n,a(function(){t.dismiss("cancel")},1e3),e.cancel=function(){t.dismiss("cancel")}}]).controller("WarningModalCtrl",["$scope","$modalInstance","promptTxt",function(e,t,n){"use strict";"string"==typeof n?e.titleInfo=n:(e.titleInfo=n.title,e.detailInfo=n.msg),e.cancel=function(){t.dismiss("cancel")}}]).controller("ConfirmModalCtr",["$scope","$modalInstance","promptTxt",function(e,t,n){"use strict";e.promptTxt=n,e.cancel=function(){t.dismiss("cancel")},e.sure=function(){t.close()}}]).controller("DeleteModalCtr",["$scope","$modalInstance","promptTxt",function(e,t,n){"use strict";e.promptTxt=n||"确定要删除吗？",e["delete"]=function(){t.close()},e.cancel=function(){t.dismiss("cancel")}}]).controller("ModifyUserInfoCtr",["$scope","user","$publicApi","$modalInstance","$domePublic",function(e,t,n,a,i){e.user=t,e.cancel=function(){a.dismiss()},e.submit=function(){var e={id:t.id,username:t.username,email:t.email,phone:t.phone};n.modifyUserInfo(e).then(function(){i.openPrompt("修改成功！"),a.close(e)},function(e){i.openWarning({title:"修改失败！",msg:e.data.resultMsg})})}}]),t.factory("$domePublic",["$modal",function(e){"use strict";var t={};t.openWarning=function(t){e.open({animation:!0,templateUrl:"warningModal.html",controller:"WarningModalCtrl",size:"sm",resolve:{promptTxt:function(){return t}}})},t.openPrompt=function(t){var n=e.open({animation:!0,templateUrl:"promptModal.html",controller:"PromptModalCtrl",size:"sm",resolve:{promptTxt:function(){return t}}});return n.result},t.openConfirm=function(t){var n=e.open({animation:!0,templateUrl:"confirmModal.html",controller:"ConfirmModalCtr",size:"sm",resolve:{promptTxt:function(){return t}}});return n.result},t.openDelete=function(t){var n=e.open({animation:!0,templateUrl:"deleteModal.html",controller:"DeleteModalCtr",size:"sm",resolve:{promptTxt:function(){return t}}});return n.result};var n=function(){this.isLoading=!1,this.loadingItems={}};return n.prototype={startLoading:function(e){this.loadingItems[e]=!0,this.isLoading||(this.isLoading=!0)},finishLoading:function(e){var t=this,n=!1;t.loadingItems[e]=!1,angular.forEach(t.loadingItems,function(e){e&&!n&&(n=!0)}),t.isLoading=n}},t.getLoadingInstance=function(){return new n},t}]).factory("$publicApi",["$http",function(e){"use strict";var t={};return t.getDomeVersion=function(){return e.get("/api/global/version")},t.getDbConfig=function(){return e.get("/api/global/database")},t.getCurrentUser=function(){return e.get("/api/user/get")},t.modifyUserInfo=function(t){return e.post("/api/user/modify",angular.toJson(t))},t.logout=function(){return e.get("/api/user/logout")},t}]),e.domeModule=t}(window),function(e){var t=angular.module("monitorApp",["ngAnimate","ui.bootstrap","publicModule","amchartsModule","domeModule"]);t.directive("datepickerComponent",["$util",function(e){var t=[];return t.push('      <div class="js-dateoptions btn-group" role="group" aria-label="..." >'),t.push('        <button class="btn btn-default js-interval">最近1小时</button>'),t.push("      </div>"),t.push('      <div class="datepicker-con js-datepicker-con">'),t.push('        <div class="date-choose">'),t.push('          <datepicker ng-model="selectDate.startDate" max-date="selectDate.endDate" show-weeks="false" custom-class="getDayClass(date, mode)" class="datepicker"></datepicker>'),t.push('          <datepicker ng-model="selectDate.endDate" min-date="selectDate.startDate" max-date="today" show-weeks="false" custom-class="getDayClass(date, mode)" class="datepicker"></datepicker>'),t.push("        </div>"),t.push('        <div class="date-result">'),t.push('          <div class="result-selected">'),t.push('            <div class="date-selected">'),t.push("              <p>开始</p>"),t.push('              <input disabled="true" type="text" value="{{selectDate.startDate| date:\'yyyy-MM-dd\'}}" class="form-control"/>'),t.push("            </div>"),t.push("          </div>"),t.push('          <div class="result-selected">'),t.push('            <div class="date-selected">'),t.push("              <p>结束</p>"),t.push('              <input disabled="true" type="text" value="{{selectDate.endDate| date:\'yyyy-MM-dd\'}}" class="form-control"/>'),t.push("            </div>"),t.push("          </div>"),t.push("          <div>"),t.push('            <button ng-click="submitSelfDate();" class="ui-btn ui-btn-primary ui-btn-md btn-submit-date">提交</button>'),t.push("          </div>"),t.push("        </div>"),t.push("      </div>"),{restrict:"AE",scope:{dateOptions:"="},replce:!0,template:t.join(""),link:function(t,n){var a,i,r,o=n.find(".js-dateoptions"),s=n.find(".js-datepicker-con"),l=[];if(t.date={startDate:0,endDate:0},t.today=new Date,s.hide(),t.setDateInterval=function(n){var a,i,r;switch(n){case"30m":t.date.startDate=(new Date).getTime()-18e5,t.date.endDate=(new Date).getTime();break;case"1h":t.date.startDate=(new Date).getTime()-36e5,t.date.endDate=(new Date).getTime();break;case"6h":t.date.startDate=(new Date).getTime()-216e5,t.date.endDate=(new Date).getTime();break;case"12h":t.date.startDate=(new Date).getTime()-432e5,t.date.endDate=(new Date).getTime();break;case"24h":t.date.startDate=(new Date).getTime()-864e5,t.date.endDate=(new Date).getTime();break;case"7d":a=e.calculateDate(new Date,-7).split("-"),t.date.startDate=new Date(a[0],a[1]-1,a[2],0,0,0).getTime(),t.date.endDate=(new Date).getTime();break;case"30d":a=e.calculateDate(new Date,-30).split("-"),t.date.startDate=new Date(a[0],a[1]-1,a[2],0,0,0).getTime(),t.date.endDate=(new Date).getTime();break;case"self":i=e.calculateDate(new Date(t.selectDate.startDate),0).split("-"),r=e.calculateDate(new Date(t.selectDate.endDate),1).split("-"),t.date.startDate=new Date(i[0],i[1]-1,i[2],0,0,0).getTime(),t.date.endDate=new Date(r[0],r[1]-1,r[2],0,0,0).getTime()-1;break;default:return}t.$emit("dateIntervalChange",t.date)},t.dateOptions){for(r=0;r<t.dateOptions.length;r++)t.dateOptions[r].isDefault?(l.push('<button class="btn btn-default active js-interval" data-interval="'+t.dateOptions[r].interval+'">'+t.dateOptions[r].text+"</button>"),t.setDateInterval(t.dateOptions[r].interval),t.selectDate=t.date):l.push('<button class="btn btn-default js-interval" data-interval="'+t.dateOptions[r].interval+'">'+t.dateOptions[r].text+"</button>");l.push('<button class="btn btn-default js-custom">自定义</button>')}o.html(l.join("")),a=n.find(".js-interval"),i=n.find(".js-custom"),a.bind("click",function(){var e=angular.element(this);e.hasClass("active")||(a.removeClass("active"),i.removeClass("active"),e.addClass("active")),s.hide(),t.setDateInterval(e.data("interval")),t.selectDate=angular.copy(t.date),t.$digest()}),i.bind("click",function(){s.is(":visible")?s.hide():s.show()}),t.submitSelfDate=function(){t.setDateInterval("self"),s.hide(),i.hasClass("active")||(i.addClass("active"),a.removeClass("active"))}}}}]).directive("chartHeight",function(){return{restrict:"A",link:function(e,t,n){e.chartWraperHeight=0,e.$watch(function(){return n.chartHeight},function(t){t=parseInt(t),e.chartWraperHeight=330+15*t}),e.getFullChartStyle=function(){return{height:e.chartWraperHeight+"px"}},e.getShortChatStyle=function(){return{height:e.chartWraperHeight-43+"px"}}}}}),t.service("$monitor",["$http","$q","$util","$filter",function(t,n,a,i){"use strict";function r(){D={cpu:{},mem:{},diskUsedMult:[],diskReadMult:[],diskWriteMult:[],netInMult:[],netIn:{},netOutMult:[],netOut:{},keyMap:{busy:"CPU总占用",user:"用户级进程",nice:"nice值为负的用户级进程",system:"内核级进程",iowait:"等待磁盘IO",irq:"CPU服务硬中断",softirq:"CPU服务软中断",switches:"CPU上下文每秒切换次数"}},b={monitorItem:[],monitorType:""},y={tableLength:6,tableKeyName:"",tableHead:[],tableItem:[]}}function o(e,t,n){return null===e||isNaN(e)?"——":(n||(n=""),e.toFixed(t)+n)}function s(t,n){return null===t||t===e?"——":a.formartBytesData(t,n)}function l(t,n){var a,i,r,l,u={},c=[{key:{text:"最小值"}},{key:{text:"最大值"}},{key:{text:"平均值"}}];for(a=0;a<b.monitorItem.length;a++)u[b.monitorItem[a]]={min:{value:void 0},max:{value:0},sum:0,countHasData:0,average:0};for(a=0;a<t.length;a++)for(i=0;i<b.monitorItem.length;i++)r=t[a][b.monitorItem[i]],l=u[b.monitorItem[i]],r!==e&&null!==r&&(u[b.monitorItem[i]].countHasData++,r>l.max.value&&(u[b.monitorItem[i]].max.value=r,u[b.monitorItem[i]].max.time=t[a].timeStamp),(l.min.value===e||r<l.min.value)&&(u[b.monitorItem[i]].min.value=r,u[b.monitorItem[i]].min.time=t[a].timeStamp),u[b.monitorItem[i]].sum+=r);return angular.forEach(u,function(e,t){0!==e.countHasData&&(e.average=e.sum/e.countHasData),n?"%"==n?(e.min={text:o(e.min.value,2,n),tip:f(e.min.time)},e.max={text:o(e.max.value,2,n),tip:f(e.max.time)},e.average={text:o(e.average,2,n)}):(e.min={text:s(e.min.value,n),tip:f(e.min.time)},e.max={text:s(e.max.value,n),tip:f(e.max.time)},e.average={text:s(e.average,n)}):(e.min={text:e.min.value,tip:f(e.min.time)},e.max={text:e.max.value,tip:f(e.max.time)},e.average={text:e.average}),"container"==b.monitorType&&(t=t.substring(0,12)),c[0][t]=e.min,c[1][t]=e.max,c[2][t]=e.average}),c}function u(t,n){var a,i,r,l,u=0,c=t.length,d=!1,m=[];for(a=c-1;a>=0&&u<y.tableLength;a--){if(r=t[a],l={},!d)for(i=0;i<b.monitorItem.length;i++){var p=r[b.monitorItem[i]];if(null!==p&&p!==e){d=!0;break}}if(d){for(l.key={text:f(t[a].timeStamp)},i=0;i<b.monitorItem.length;i++){var h="container"===b.monitorType?b.monitorItem[i].substring(0,12):b.monitorItem[i];"%"==n?l[h]={text:o(t[a][b.monitorItem[i]],2,"%")}:l[h]={text:s(t[a][b.monitorItem[i]],n)}}m.push(l),u++}}return m}function c(e,t,n,a){t.head=y.tableHead,t.item=y.tableItem,e?t.body=l(n,a):t.body=u(n,a)}function d(t,n){var a;for(a=t.length-4;a>=0;a--)if(t[a][n]!==e&&null!==t[a][n])return a;return-1}function m(t,n,a){return t&&t[n]?t[n][a]:e}function f(t){return t!==e&&null!==t?i("date")(t,"yyyy-MM-dd HH:mm:ss"):void 0}function p(t,n){if(!n)return n;for(var a=angular.copy(n),i=0;i<a.length;i++)for(var r=0;r<t.length;r++){var o=a[i][t[r]];null===o||o===e||isNaN(o)||(a[i][t[r]]=o.toFixed(2))}return a}function h(e,t,n){if(!t)return t;for(var i=angular.copy(t),r=0;r<i.length;r++)for(var o=0;o<e.length;o++)i[r][e[o]]&&(i[r][e[o]]=a.formartBytesData(i[r][e[o]],n).toFixed(2));return i}function g(t,n,a){var i,r,l,u={value:0,time:e},c={value:e,time:e},d=0,m=0,p=0;if(t&&a!==e){for(i=0;i<t.length;i++)r=t[i][a],null!==r&&r!==e&&(p++,r>u.value&&(u.value=r,u.time=t[i].timeStamp),(c.value===e||r<c.value)&&(c.value=r,c.time=t[i].timeStamp),m+=r);return 0!==p&&(d=m/p),l=n?"%"==n?{max:{text:o(u.value,2,n),tip:f(u.time)},min:{text:o(c.value,2,n),tip:f(c.time)},average:{text:o(d,2,n)}}:{max:{text:s(u.value,n),tip:f(u.time)},min:{text:s(c.value,n),tip:f(c.time)},average:{text:s(d,n)}}:{max:{text:o(u.value,2),tip:f(u.time)},min:{text:o(c.value,2),tip:f(c.time)},average:{text:o(m/t.length,2)}}}}function v(e,t){for(var n=[{key:{text:"最小值"}},{key:{text:"最大值"}},{key:{text:"平均值"}}],a=1;a<e.length;a++){var i=t[e[a]]||{min:{text:"——"},max:{text:"——"},average:{text:"——"}};n[0][e[a]]=i.min,n[1][e[a]]=i.max,n[2][e[a]]=i.average}return n}var y,b,D,x=this;r(),x.getAmchartConfig=function(e,t,n){var a={type:"serial",categoryField:"timeStamp",pathToImages:"/lib/images/amcharts/",zoomOutButtonAlpha:.26,startDuration:0,chartScrollbar:{},chartCursor:{categoryBalloonDateFormat:"JJ:NN:SS"},categoryAxis:{minPeriod:"ss",parseDates:!0,labelOffset:6,offset:1,equalSpacing:!0},graphs:[],titles:[{id:"Title-1",size:15,text:e}],dataProvider:t,trendLines:[],guides:[],valueAxes:[],allLabels:[],balloon:{}};""===e&&(a.titles=[]);for(var i=0;i<b.monitorItem.length;i++)a.graphs.push({bullet:"round",id:"AmGraph"+i,title:b.monitorItem[i],bulletField:b.monitorItem[i],balloonText:"[["+b.monitorItem[i]+"]]"+n,valueField:b.monitorItem[i]}),a.legend={useGraphSettings:!0,valueWidth:120,valueText:"[[value]]"+n};return a},x.getMonitorsArr=function(t,n,a,i){var l,u,k,M,I,C,w,S=y.tableLength,T=[],A=[],R=y.tableKeyName=i?"统计值":"时间";if(r(),n.length<2&&(u=n[0]),T=function(){var e=angular.copy(n);return e.unshift(R),e}(),A=angular.copy(n),"container"==t.targetType){for(l=0;l<A.length;l++)A[l]=A[l].substring(0,12);for(l=1;l<T.length;l++)T[l]=T[l].substring(0,12)}if(A.unshift("key"),y.tableItem=A,y.tableHead=T,b.monitorItem=n,b.monitorType=a.targetType,"node"==a.targetType){if(a.counterResults["cpu.busy"]){if(C=a.counterResults["cpu.busy"],I={head:[],item:[],body:[]},u!==e){if(I.head=[R,"busy","user","nice","system","iowait","irq","softirq","switches"],I.item=["key","busy","user","nice","system","iowait","irq","softirq","switches"],i)w={busy:g(C,"%",u),user:g(a.counterResults["cpu.user"],"%",u),nice:g(a.counterResults["cpu.nice"],"%",u),system:g(a.counterResults["cpu.system"],"%",u),iowait:g(a.counterResults["cpu.iowait"],"%",u),irq:g(a.counterResults["cpu.irq"],"%",u),softirq:g(a.counterResults["cpu.softirq"],"%",u),switches:g(a.counterResults["cpu.switches"],"",u)},I.body=v(I.item,w);else if(k=d(C,u),-1!==k)for(M=k-S;k>=0&&k>M;k--)I.body.push({key:{text:f(m(C,k,"timeStamp"))},busy:{text:o(m(C,k,u),2,"%")},user:{text:o(m(a.counterResults["cpu.user"],k,u),2,"%")},nice:{text:o(m(a.counterResults["cpu.nice"],k,u),2,"%")},system:{text:o(m(a.counterResults["cpu.system"],k,u),2,"%")},iowait:{text:o(m(a.counterResults["cpu.iowait"],k,u),2,"%")},irq:{text:o(m(a.counterResults["cpu.irq"],k,u),2,"%")},softirq:{text:o(m(a.counterResults["cpu.softirq"],k,u),2,"%")},switches:{text:o(m(a.counterResults["cpu.switches"],k,u),2)}})}else c(i,I,C,"%");D.cpu={chartData:x.getAmchartConfig("CPU使用率(%)",p(n,C),"%"),tableData:I}}angular.forEach(a.counterResults,function(t,r){var l=r.split("=")[1];if(l)if(-1!==r.indexOf("df.bytes.used.percent/")){if(I={head:[],item:[],body:[]},u!==e){if(I.head=[R,"磁盘占用(GB)","磁盘总量(GB)","磁盘占用率"],I.item=["key","mountused","mounttotal","mountpercent"],i)w={mountused:g(a.counterResults["df.bytes.used/mount="+l],"GB",u),mounttotal:g(a.counterResults["df.bytes.total/mount="+l],"GB",u),mountpercent:g(t,"%",u)},I.body=v(I.item,w);else if(k=d(t,u),-1!==k)for(M=k-S;k>=0&&k>M;k--)I.body.push({key:{text:f(m(t,k,"timeStamp"))},mountpercent:{text:o(m(t,k,u),2,"%")},mountused:{text:s(m(a.counterResults["df.bytes.used/mount="+l],k,u),"GB")},mounttotal:{text:s(m(a.counterResults["df.bytes.total/mount="+l],k,u),"GB")}})}else c(i,I,t,"%");D.diskUsedMult.push({name:l,chartData:x.getAmchartConfig("",p(n,t),"%"),tableData:I})}else if(-1!==r.indexOf("disk.io.read_bytes/")||-1!==r.indexOf("disk.io.write_bytes/")){var y=-1!==r.indexOf("disk.io.read_bytes/");if(I={head:[],item:[],body:[]},u!==e){if(I.head=y?[R,"读取数据(KB/s)"]:[R,"写入数据(KB/s)"],I.item=["key","data"],i)w={data:g(t,"KB",u)},I.body=v(I.item,w);else if(k=d(t,u),-1!==k)for(M=k-S;k>=0&&k>M;k--)I.body.push({key:{text:f(m(t,k,"timeStamp"))},data:{text:s(m(t,k,u),"KB")}})}else c(i,I,t,"KB");y?D.diskReadMult.push({name:l,chartData:x.getAmchartConfig("",h(n,t,"KB"),"KB/s"),tableData:I}):D.diskWriteMult.push({name:l,chartData:x.getAmchartConfig("",h(n,t,"KB"),"KB/s"),tableData:I})}else if(-1!==r.indexOf("net.if.out.bytes/")||-1!==r.indexOf("net.if.in.bytes/")){var b=-1!==r.indexOf("net.if.out.bytes/");if(I={head:[],item:[],body:[]},u!==e){if(I.head=b?[R,"流出数据(KB/s)"]:[R,"流入数据(KB/s)"],I.item=["key","netdata"],i)w={netdata:g(t,"KB",u)},I.body=v(I.item,w);else if(k=d(t,u),-1!==k)for(M=k-S;k>=0&&k>M;k--)I.body.push({key:{text:f(m(t,k,"timeStamp"))},netdata:{text:s(m(t,k,u),"KB")}})}else c(i,I,t,"KB");b?D.netOutMult.push({name:l,chartData:x.getAmchartConfig("",h(n,t,"KB"),"KB/s"),tableData:I}):D.netInMult.push({name:l,chartData:x.getAmchartConfig("",h(n,t,"KB"),"KB/s"),tableData:I})}})}else{if(a.counterResults["container.cpu.usage.busy"]){if(C=a.counterResults["container.cpu.usage.busy"],I={head:[],item:[],body:[]},u!==e){if(I.head=[R,"busy","user","system"],I.item=["key","busy","user","system"],i)w={busy:g(C,"%",u),user:g(a.counterResults["container.cpu.usage.user"],"%",u),system:g(a.counterResults["container.cpu.usage.system"],"%",u)},I.body=v(I.item,w);else if(k=d(C,u),-1!==k)for(M=k-S;k>=0&&k>M;k--)I.body.push({key:{text:f(m(a.counterResults["container.cpu.usage.busy"],k,"timeStamp"))},busy:{text:o(m(a.counterResults["container.cpu.usage.busy"],k,u),2,"%")},user:{text:o(m(a.counterResults["container.cpu.usage.user"],k,u),2,"%")},system:{text:o(m(a.counterResults["container.cpu.usage.system"],k,u),2,"%")}})}else c(i,I,C,"%");D.cpu={chartData:x.getAmchartConfig("CPU占用率(%)",p(n,C),"%"),tableData:I}}angular.forEach(["container.net.if.in.bytes","container.net.if.out.bytes"],function(t){if(a.counterResults[t]){var r="container.net.if.in.bytes"===t;if(C=a.counterResults[t],I={head:[],item:[],body:[]},u!==e){if(I.head=r?[R,"流入数据(KB/s)"]:[R,"流出数据(KB/s)"],I.item=["key","netdata"],i)w={netdata:g(C,"KB",u)},I.body=v(I.item,w);else if(k=d(C,u),-1!==k)for(M=k-S;k>=0&&k>M;k--)I.body.push({key:{text:f(m(C,k,"timeStamp"))},netdata:{text:s(m(C,k,u),"KB")}})}else c(i,I,C,"KB");r?D.netIn={chartData:x.getAmchartConfig("网络流入(KB/s)",h(n,C,"KB"),"KB/s"),tableData:I}:D.netOut={chartData:x.getAmchartConfig("网络流出(KB/s)",h(n,C,"KB"),"KB/s"),tableData:I}}})}if(a.counterResults["mem.memused.percent"]||a.counterResults["container.mem.usage.percent"]){I={head:[],item:[],body:[]};var $,B,O;if(a.counterResults["mem.memused.percent"]?($=a.counterResults["mem.memused.percent"],B=a.counterResults["mem.memtotal"],O=a.counterResults["mem.memused"]):($=a.counterResults["container.mem.usage.percent"],B=a.counterResults["container.mem.limit"],O=a.counterResults["container.mem.usage"]),u!==e){if(a.counterResults["mem.memused.percent"]?I.head=[R,"内存占用量(MB)","内存总量(MB)","内存占用率"]:I.head=[R,"内存占用量(MB)","内存限额(MB)","内存占用率"],I.item=["key","memused","memtotal","mempercent"],i)w={memused:g(O,"MB",u),memtotal:g(B,"MB",u),mempercent:g($,"%",u)},I.body=v(I.item,w);else if(k=d($,u),-1!==k)for(M=k-S;k>=0&&k>M;k--)I.body.push({key:{text:f(m($,k,"timeStamp"))},memused:{text:s(m(O,k,u),"MB")},memtotal:{text:s(m(B,k,u),"MB")},mempercent:{text:o(m($,k,u),2,"%")}})}else c(i,I,$,"%");D.mem={chartData:x.getAmchartConfig("内存占用率(%)",p(n,$),"%"),tableData:I}}return D},x.getMonitor=function(e){return t.get("/api/monitor/data/"+e.targetId+"?start="+e.start+"&end="+e.end+"&dataSpec="+e.dataSpec+"&cid="+e.cid)}}]),t.controller("MonitorCtr",["$scope","$http","$util","$monitor","$q","$timeout","$domePublic",function(e,t,n,a,i,r,o){"use strict";e.sampleTypes=[{type:"MIN",text:"最小值"},{type:"MAX",text:"最大值"},{type:"AVERAGE",text:"平均值"}];var s=n.getQueryString("id"),l=n.getQueryString("cid");e.clusterName=n.getQueryString("cname"),e.singleItem=!1,e.monitorItem=[],e.monitorTypeName="",e.isLoading=!0,e.isRealTime=!1;var u,c=function(){var n=i.defer();return e.targetInfos?n.resolve(e.targetInfos):t.get("/api/monitor/target/"+s+"?cid="+l).then(function(t){e.targetInfos=t.data.result,e.monitorItem=[];var a,i=e.targetInfos.targetInfos;switch(e.targetInfos.targetType){case"node":for(e.monitorTypeName="主机",e.singleItem=i[0].node,a=0;a<i.length;a++)e.monitorItem.push(i[a].node);break;case"pod":for(e.monitorTypeName="实例",e.singleItem=i[0].pod.podName,a=0;a<i.length;a++)e.monitorItem.push(i[a].pod.podName);break;case"container":for(e.monitorTypeName="容器",e.singleItem=i[0].container.containerId.substring(0,12),a=0;a<i.length;a++)e.monitorItem.push(i[a].container.containerId);break;default:e.singleItem=!1}e.monitorItem.length>1&&(e.singleItem=!1),n.resolve(e.targetInfos)},function(e){o.openWarning({title:"请求失败！",msg:"Message:"+e.data.resultMsg}),n.reject()}),n.promise};c(),e.date={},e.intervalTime=0,e.monitorsInfo={cpu:{chartData:[]},mem:{chartData:[]},diskUsedMult:[],diskWriteMult:[],diskReadMult:[],netInMult:[],netOutMult:[],netIn:{chartData:[]},netOut:{chartData:[]}},e.selectedMonitor={diskUsedMult:{name:"",chartData:[],tableData:{}},diskReadMult:{name:"",chartData:[],tableData:{}},diskWriteMult:{name:"",chartData:[],tableData:{}},netInMult:{name:"",chartData:[],tableData:{}},netOutMult:{name:"",chartData:[],tableData:{}}},e.currentSampleType=e.sampleTypes[2];var d=function(t){var n=!1;if(e.selectedMonitor[t])if(""!==e.selectedMonitor[t].name){for(var a=0;a<e.monitorsInfo[t].length;a++)e.monitorsInfo[t][a].name===e.selectedMonitor[t].name&&(n=!0,e.toggleSelectedMonitor(t,a));n||e.toggleSelectedMonitor(t,0)}else e.toggleSelectedMonitor(t,0)},m=function(){u&&r.cancel(u),c().then(function(){var t={targetId:s,start:e.date.startDate,end:e.date.endDate,dataSpec:e.currentSampleType.type,cid:l};a.getMonitor(t).then(function(n){var i=n.data.result||{};(!i.interval||i.interval<5)&&(i.interval=5),e.intervalTime=1e3*i.interval,e.monitorsInfo=null,e.monitorsInfo=angular.copy(a.getMonitorsArr(t,e.monitorItem,i,!e.isRealTime)),d("diskUsedMult"),d("diskReadMult"),d("diskWriteMult"),d("netInMult"),d("netOutMult"),e.isRealTime&&(u=r(function(){e.date.endDate=(new Date).getTime(),e.date.startDate=e.date.endDate-36e5,m()},e.intervalTime))})["finally"](function(){e.isLoading=!1})},function(){e.isLoading=!1})};e.toggleSelectedMonitor=function(t,n){e.monitorsInfo[t]&&(e.selectedMonitor[t]=e.monitorsInfo[t][n])},e.toggleSampleType=function(t){e.isLoading=!0,e.currentSampleType=e.sampleTypes[t],m()},e.$on("dateIntervalChange",function(t,n){e.date=n,e.isLoading=!0,e.date.endDate-(new Date).getTime()<2e3&&e.date.endDate-e.date.startDate<37e5?e.isRealTime=!0:e.isRealTime=!1,m()})}])}();