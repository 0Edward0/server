function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}!function(){"use strict";var e=angular.module("amchartsModule",[]);e.directive("amchart",function(){return{replace:!0,scope:{options:"=ngModel",type:"@"},template:'<div class="amchart" style="width: 100%; height: 100%;"></div>',link:function(e,t){var n=function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()},a=n();t.attr("id",a);var i,r=function(){i&&i.clear();var t=e.options,n=Object.keys(t);switch(e.type){case"serial":i=new AmCharts.AmSerialChart;break;case"pie":i=new AmCharts.AmPieChart;break;case"funnel":i=new AmCharts.AmFunnelChart;break;case"gauge":i=new AmCharts.AmAngularGauge;break;case"radar":i=new AmCharts.AmRadarChart;break;case"xy":i=new AmCharts.AmXYChart}i.dataProvider=t.data;for(var r=0;r<n.length;r++)"object"!=typeof t[n[r]]&&"function"!=typeof t[n[r]]?i[n[r]]=t[n[r]]:i[n[r]]=angular.copy(t[n[r]]);i.write(a)};r(e.options),e.$watch("options",function(e){a!==t[0].id&&a||r(e)},!0)}}}),window.amchartsApp=e}();var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),publicModule=angular.module("publicModule",[]);publicModule.service("$util",["$q",function(e){"use strict";var t=function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0},n=function(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),n=window.location.search.substr(1).match(t);return null!==n?unescape(n[2]):null},a=function(e,t){return null===e||void 0===e||isNaN(e)?e:"number"!=typeof e?parseFloat(parseFloat(e).toFixed(t)):parseFloat(e.toFixed(t))},i=function(e,t){if(void 0!==e&&null!==e&&!isNaN(e)){switch(t){case"MB":e=(+e/1024/1024).toFixed(2);break;case"GB":e=(+e/1024/1024/1024).toFixed(2);break;case"KB":e=(+e/1024).toFixed(2);break;default:e=+e.toFixed(2)}return+e}},r=function(e,t){for(var n,a=new RegExp("{#([a-zA-z0-9]+)}");null!==(n=a.exec(e));){var i=0===t[n[1]]?"0":t[n[1]]||"";e=e.replace(new RegExp(n[0],"g"),i)}return e},o=function(e){var t,n=0;for(t in e)e.hasOwnProperty(t)&&n++;return n},s=function(e){return!!(!e||e&&t(e))},u=function(e,t){e=new Date(e),e.setDate(e.getDate()+t);var n=e.getFullYear(),a=e.getMonth()+1;10>a&&(a="0"+a);var i=e.getDate();return 10>i&&(i="0"+i),n+"-"+a+"-"+i},l=function(e,t,n){var a={};void 0===t&&(t=(new Date).getTime());var i=t-e;return a.day=Math.floor(i/864e5),i-=24*a.day*3600*1e3,a.hours=Math.floor(i/36e5),i-=3600*a.hours*1e3,a.mimutes=Math.floor(i/6e4),n&&(i-=60*a.mimutes*1e3,a.seconds=Math.floor(i/1e3)),a},c=function(e,t){var n,a="";return!e||!t||0>=t-e?a="0秒":(n=l(e,t,!0),0!==n.day&&(a+=n.day+"天"),0!==n.hours&&(a+=n.hours+"小时"),0!==n.mimutes&&(a+=n.mimutes+"分钟"),0!==n.seconds&&(a+=n.seconds+"秒"),""===a&&(a="0秒")),a},d=function(e,t,n){if(!e&&!t||0>=e-t)return"无";var a,i=l(e,t,n),r=i.day,o=i.hours,s=i.mimutes;return a=0>r||0>o||0>s?"刚刚":r>60?"更早":r>30?"一个月前":r>3?r+"天前":3==r?"三天前":2==r?"两天前":1==r?"昨天":o>=1?o+"小时前":0===s?"刚刚":s+"分钟前"},m=function(t){var n=e.defer();return $.getScript(t,function(){n.resolve()}),n.promise};return{isEmptyObject:t,parseTpl:r,toDecimal:a,formartBytesData:i,getQueryString:n,objLength:o,isNullorEmpty:s,calculateDate:u,getPageInterval:c,getDateInterval:l,getPageDate:d,loadJs:m}}]).factory("$domeModel",["$http",function(e){"use strict";var t=function(e,t){var n,a=e;for(n=0;n<t.length;n++)a+="/"+t[n];return a},n=function(){function e(t){_classCallCheck(this,e),this.selectListName=t?t:"selectList",this.isCheckAll=!1,this.selectedCount=0,this[this.selectListName]=[]}return _createClass(e,[{key:"init",value:function(e,t){var n=this;this.isCheckAll=!1,this.selectedCount=0,this[this.selectListName]=function(){if(e&&0!==e.length){if("object"===_typeof(e[0]))for(var a=0;a<e.length;a++)e[a].keyFilter=!0,void 0!==t&&(e[a].isSelected=t),e[a].isSelected&&n.selectedCount++;else for(var i=0;i<e.length;i++)e[i]={item:e[i],keyFilter:!0,isSelected:t},void 0!==t&&(e[i].isSelected=t),e[i].isSelected&&n.selectedCount++;return n.selectedCount===e.length&&(n.isCheckAll=!0),e}return[]}()}},{key:"toggleCheck",value:function(e,t){var n=!0;if(e.isSelected=t,t){this.selectedCount++;var a=this[this.selectListName],i=!0,r=!1,o=void 0;try{for(var s,u=a[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var l=s.value;if(l.keyFilter&&!l.isSelected){n=!1;break}}}catch(c){r=!0,o=c}finally{try{!i&&u["return"]&&u["return"]()}finally{if(r)throw o}}n&&(this.isCheckAll=!0)}else this.selectedCount--,this.isCheckAll=!1}},{key:"checkAllItem",value:function(e){this.isCheckAll=void 0===e?this.isCheckAll:e,this.selectedCount=0;var t=this[this.selectListName],n=!0,a=!1,i=void 0;try{for(var r,o=t[Symbol.iterator]();!(n=(r=o.next()).done);n=!0){var s=r.value;s.keyFilter&&this.isCheckAll?(s.isSelected=!0,this.selectedCount++):s.isSelected=!1}}catch(u){a=!0,i=u}finally{try{!n&&o["return"]&&o["return"]()}finally{if(a)throw i}}}},{key:"filterWithKey",value:function(e,t){this.isCheckAll=!1,this.selectedCount=0,void 0===t&&(t="item");var n=this[this.selectListName];if(void 0!==n[0][t]){var a=!0,i=!1,r=void 0;try{for(var o,s=n[Symbol.iterator]();!(a=(o=s.next()).done);a=!0){var u=o.value;u.isSelected=!1,u.keyFilter=-1!==u[t].indexOf(e)}}catch(l){i=!0,r=l}finally{try{!a&&s["return"]&&s["return"]()}finally{if(i)throw r}}}}}]),e}(),a=function(n){var a=this;a.getData=function(){return e.get(t(n,arguments))},a.setData=function(t,a){return e.post(n,t,a)},a.updateData=function(t){return e.put(n,t)},a.deleteData=function(){return e["delete"](t(n,arguments))}},i=function(e){return e||(e={}),function(t){for(var n=arguments.length,a=Array(n>1?n-1:0),i=1;n>i;i++)a[i-1]=arguments[i];return function(){var n,i=e[t];return i&&"function"==typeof i?n=new(Function.prototype.bind.apply(i,[null].concat(a))):(n={},console.log("error:there is no "+t)),n}()}};return{SelectListModel:n,ServiceModel:a,instancesCreator:i}}]).provider("$domeData",function(){"use strict";var e={},t=function(t,n){e[t]=n},n=function(t){return e[t]},a=function(t){e[t]&&(e[t]=null)};return{setData:t,$get:function(){return{setData:t,getData:n,delData:a}}}}),publicModule.directive("selectCon",function(){"use strict";return{restrict:"AEC",scope:!0,transclude:!0,replace:!0,template:"<div ng-transclude></div>",controller:["$scope",function(e){this.hideSelect=function(){e.hideSelect()}}],link:function(e,t,n){var a=t.find(".select-list"),i=t.find(".ui-btn-select"),r=t.find(".drop"),o=!1;if(0!==i.length){a.hide(),i.on("blur",u);var s=function(e){o=void 0!==e?e:!o,o===!0?(a.show(),r.removeClass("up")):o===!1&&(a.hide(),r.addClass("up"))},u=function(e){return s(!1),e.stopPropagation()};i.on("blur",u),a.on("mouseenter",function(){i.off("blur",u)}).on("mouseleave",function(){i.on("blur",u)}),"INPUT"===i[0].tagName?i.on("focus",function(){s(!0)}):i.on("click",function(){s()}),"true"==n.label&&(t.on("click",function(){i.focus()}),i.bind("focus",function(e){i.width(t.width()-20-i.position().left),e.stopPropagation()}).bind("blur",function(){i.width(120)})),e.hideSelect=function(){s(!1)}}}}}).directive("selectItem",["$compile",function(e){"use strict";return{restrict:"AEC",require:"^?selectCon",link:function(t,n,a,i){t.hideSelect=function(){i.hideSelect()};var r=angular.element(a.$$element.find(">a")[0]),o=r.attr("ng-click");o?o+=";hideSelect($event.stopPropagation());":o="hideSelect($event.stopPropagation())",r.attr("ng-click",o),n.html(e(n.html())(t))}}}]).directive("loading",function(){"use strict";return{restrict:"AE",template:'<div class="com-loading"><div class="dot1"></div><div class="dot2"></div></div>',replace:!0}}).directive("domeRadio",function(){"use strict";return{restrict:"E",scope:{radioModel:"=dModel",label:"@dLabel",name:"@dName",id:"@dId",disabled:"@dDisabled",value:"@dValue",changeEvent:"&dChange"},replace:!0,template:'<span><input id="{{id}}" type="radio" name="{{name}}" class="ui-radio" ng-value="{{value}}" ng-model="radioModel" ng-change="changeEvent({model:radioModel})" ng-disabled="{{disabled}}"/><label ng-bind="label" for="{{id}}"></label></span>'}}).directive("domeCheck",function(){"use strict";return{restrict:"E",scope:{checkModel:"=ngModel",label:"@dLabel",name:"@dName",id:"@dId",trueValue:"@dTrueValue",falseValue:"@dFalseValue",changeEvent:"&dChange"},replace:!0,template:'<span><input id="{{id}}" type="checkbox" name="{{name}}" class="ui-check" ng-true-value="{{trueValue||true}}"  ng-false-value="{{falseValue||false}}" ng-model="checkModel" ng-change="changeEvent({model:checkModel})" /><label ng-bind="label" for="{{id}}"></label></span>'}}),publicModule.directive("notEqual",function(){return{restrict:"A",require:"ngModel",scope:{notEqual:"=notEqual"},link:function(e,t,n,a){a.$parsers.unshift(function(t){var n=void 0===e.notEqual?!1:e.notEqual.toString()===t;return a.$setValidity("notEqual",!n),t})}}}).directive("equal",function(){return{restrict:"A",require:"ngModel",scope:{equal:"=equal"},link:function(e,t,n,a){a.$parsers.unshift(function(t){var n=void 0===e.equal?!0:e.equal.toString()===t;return a.$setValidity("equal",n),t})}}}),function(){var e=angular.module("domeModule",[]);e.config(["$httpProvider",function(e){"use strict";e.defaults.headers.post["Content-Type"]="application/json;charset=UTF-8",e.interceptors.push(["$rootScope","$q",function(e,t){return{response:function(e){return"string"==typeof e.data&&e.data.indexOf('<html ng-app="loginApp">')>=0&&(-1!==e.config.url.indexOf("api/user/logout")?location.href="/login/login.html":location.href="/login/login.html?redirect="+encodeURIComponent(location.href)),e.config.notIntercept?e:e.data.resultCode&&200!=e.data.resultCode?t.reject(e):e||t.resolve(e)}}}])}]),e.controller("PromptModalCtrl",["$scope","$modalInstance","promptTxt","$timeout",function(e,t,n,a){"use strict";e.promptTxt=n,a(function(){t.dismiss("cancel")},1e3),e.cancel=function(){t.dismiss("cancel")}}]).controller("WarningModalCtrl",["$scope","$modalInstance","promptTxt",function(e,t,n){"use strict";"string"==typeof n?e.titleInfo=n:(e.titleInfo=n.title,e.detailInfo=n.msg),e.cancel=function(){t.dismiss("cancel")}}]).controller("ConfirmModalCtr",["$scope","$modalInstance","promptTxt",function(e,t,n){"use strict";e.promptTxt=n,e.cancel=function(){t.dismiss("cancel")},e.sure=function(){t.close()}}]).controller("DeleteModalCtr",["$scope","$modalInstance","promptTxt",function(e,t,n){"use strict";e.promptTxt=n||"确定要删除吗？",e["delete"]=function(){t.close()},e.cancel=function(){t.dismiss("cancel")}}]).controller("ModifyUserInfoCtr",["$scope","user","$publicApi","$modalInstance","$domePublic",function(e,t,n,a,i){e.user=t,e.cancel=function(){a.dismiss()},e.submit=function(){var e={id:t.id,username:t.username,email:t.email,phone:t.phone};n.modifyUserInfo(e).then(function(){i.openPrompt("修改成功！"),a.close(e)},function(e){i.openWarning({title:"修改失败！",msg:e.data.resultMsg})})}}]),e.factory("$domePublic",["$modal",function(e){"use strict";var t={};t.openWarning=function(t){e.open({animation:!0,templateUrl:"warningModal.html",controller:"WarningModalCtrl",size:"sm",resolve:{promptTxt:function(){return t}}})},t.openPrompt=function(t){var n=e.open({animation:!0,templateUrl:"promptModal.html",controller:"PromptModalCtrl",size:"sm",resolve:{promptTxt:function(){return t}}});return n.result},t.openConfirm=function(t){var n=e.open({animation:!0,templateUrl:"confirmModal.html",controller:"ConfirmModalCtr",size:"sm",resolve:{promptTxt:function(){return t}}});return n.result},t.openDelete=function(t){var n=e.open({animation:!0,templateUrl:"deleteModal.html",controller:"DeleteModalCtr",size:"sm",resolve:{promptTxt:function(){return t}}});return n.result};var n=function(){this.isLoading=!1,this.loadingItems={}};return n.prototype={startLoading:function(e){this.loadingItems[e]=!0,this.isLoading||(this.isLoading=!0)},finishLoading:function(e){var t=this,n=!1;t.loadingItems[e]=!1,angular.forEach(t.loadingItems,function(e){e&&!n&&(n=!0)}),t.isLoading=n}},t.getLoadingInstance=function(){return new n},t}]).factory("$publicApi",["$http",function(e){"use strict";var t={};return t.getDomeVersion=function(){return e.get("/api/global/version")},t.getDbConfig=function(){return e.get("/api/global/database")},t.getCurrentUser=function(){return e.get("/api/user/get")},t.modifyUserInfo=function(t){return e.post("/api/user/modify",angular.toJson(t))},t.logout=function(){return e.get("/api/user/logout")},t}]),window.domeModule=e}();var monitorApp=angular.module("monitorApp",["ngAnimate","ui.bootstrap","publicModule","amchartsModule","domeModule"]);monitorApp.directive("datepickerComponent",["$util",function(e){"use strict";var t=[];return t.push('      <div class="js-dateoptions btn-group" role="group" aria-label="..." >'),t.push('        <button class="btn btn-default js-interval">最近1小时</button>'),t.push("      </div>"),t.push('      <div class="datepicker-con js-datepicker-con">'),t.push('        <div class="date-choose">'),t.push('          <datepicker ng-model="selectDate.startDate" max-date="selectDate.endDate" show-weeks="false" custom-class="getDayClass(date, mode)" class="datepicker"></datepicker>'),t.push('          <datepicker ng-model="selectDate.endDate" min-date="selectDate.startDate" max-date="today" show-weeks="false" custom-class="getDayClass(date, mode)" class="datepicker"></datepicker>'),t.push("        </div>"),t.push('        <div class="date-result">'),t.push('          <div class="result-selected">'),t.push('            <div class="date-selected">'),t.push("              <p>开始</p>"),t.push('              <input disabled="true" type="text" value="{{selectDate.startDate| date:\'yyyy-MM-dd\'}}" class="form-control"/>'),t.push("            </div>"),t.push("          </div>"),t.push('          <div class="result-selected">'),t.push('            <div class="date-selected">'),t.push("              <p>结束</p>"),t.push('              <input disabled="true" type="text" value="{{selectDate.endDate| date:\'yyyy-MM-dd\'}}" class="form-control"/>'),t.push("            </div>"),t.push("          </div>"),t.push("          <div>"),t.push('            <button ng-click="submitSelfDate();" class="ui-btn ui-btn-primary ui-btn-md btn-submit-date">提交</button>'),t.push("          </div>"),t.push("        </div>"),t.push("      </div>"),{restrict:"AE",scope:{dateOptions:"="},replce:!0,template:t.join(""),link:function(t,n){var a,i,r,o=n.find(".js-dateoptions"),s=n.find(".js-datepicker-con"),u=[];if(t.date={startDate:0,endDate:0},t.today=new Date,s.hide(),t.setDateInterval=function(n){var a,i,r;switch(n){case"30m":t.date.startDate=(new Date).getTime()-18e5,t.date.endDate=(new Date).getTime();break;case"1h":t.date.startDate=(new Date).getTime()-36e5,t.date.endDate=(new Date).getTime();break;case"6h":t.date.startDate=(new Date).getTime()-216e5,t.date.endDate=(new Date).getTime();break;case"12h":t.date.startDate=(new Date).getTime()-432e5,t.date.endDate=(new Date).getTime();break;case"24h":t.date.startDate=(new Date).getTime()-864e5,t.date.endDate=(new Date).getTime();break;case"7d":a=e.calculateDate(new Date,-7).split("-"),t.date.startDate=new Date(a[0],a[1]-1,a[2],0,0,0).getTime(),t.date.endDate=(new Date).getTime();break;case"30d":a=e.calculateDate(new Date,-30).split("-"),t.date.startDate=new Date(a[0],a[1]-1,a[2],0,0,0).getTime(),t.date.endDate=(new Date).getTime();break;case"self":i=e.calculateDate(new Date(t.selectDate.startDate),0).split("-"),r=e.calculateDate(new Date(t.selectDate.endDate),1).split("-"),t.date.startDate=new Date(i[0],i[1]-1,i[2],0,0,0).getTime(),t.date.endDate=new Date(r[0],r[1]-1,r[2],0,0,0).getTime()-1;break;default:return}t.$emit("dateIntervalChange",t.date)},t.dateOptions){for(r=0;r<t.dateOptions.length;r++)t.dateOptions[r].isDefault?(u.push('<button class="btn btn-default active js-interval" data-interval="'+t.dateOptions[r].interval+'">'+t.dateOptions[r].text+"</button>"),t.setDateInterval(t.dateOptions[r].interval),t.selectDate=t.date):u.push('<button class="btn btn-default js-interval" data-interval="'+t.dateOptions[r].interval+'">'+t.dateOptions[r].text+"</button>");u.push('<button class="btn btn-default js-custom">自定义</button>')}o.html(u.join("")),a=n.find(".js-interval"),i=n.find(".js-custom"),a.bind("click",function(){var e=angular.element(this);e.hasClass("active")||(a.removeClass("active"),i.removeClass("active"),e.addClass("active")),s.hide(),t.setDateInterval(e.data("interval")),t.selectDate=angular.copy(t.date),t.$digest()}),i.bind("click",function(){s.is(":visible")?s.hide():s.show()}),t.submitSelfDate=function(){t.setDateInterval("self"),s.hide(),i.hasClass("active")||(i.addClass("active"),a.removeClass("active"))}}}}]).directive("chartHeight",function(){return{restrict:"A",link:function(e,t,n){e.chartWraperHeight=0,e.$watch(function(){return n.chartHeight},function(t){t=parseInt(t),e.chartWraperHeight=330+15*t}),e.getFullChartStyle=function(){return{height:e.chartWraperHeight+"px"}},e.getShortChatStyle=function(){return{height:e.chartWraperHeight-43+"px"}}}}}),monitorApp.service("$monitor",["$http","$q","$util","$filter",function(e,t,n,a){"use strict";function i(){b={cpu:{},mem:{},diskUsedMult:[],diskReadMult:[],diskWriteMult:[],netInMult:[],netIn:{},netOutMult:[],netOut:{},keyMap:{busy:"CPU总占用",user:"用户级进程",nice:"nice值为负的用户级进程",system:"内核级进程",iowait:"等待磁盘IO",irq:"CPU服务硬中断",softirq:"CPU服务软中断",switches:"CPU上下文每秒切换次数"}},y={monitorItem:[],monitorType:""},v={tableLength:6,tableKeyName:"",tableHead:[],tableItem:[]}}function r(e,t,n){return null===e||isNaN(e)?"——":(n||(n=""),e.toFixed(t)+n)}function o(e,t){return null===e||void 0===e?"——":n.formartBytesData(e,t)}function s(e,t){var n,a,i,s,u={},l=[{key:{text:"最小值"}},{key:{text:"最大值"}},{key:{text:"平均值"}}];for(n=0;n<y.monitorItem.length;n++)u[y.monitorItem[n]]={min:{value:void 0},max:{value:0},sum:0,countHasData:0,average:0};for(n=0;n<e.length;n++)for(a=0;a<y.monitorItem.length;a++)i=e[n][y.monitorItem[a]],s=u[y.monitorItem[a]],void 0!==i&&null!==i&&(u[y.monitorItem[a]].countHasData++,i>s.max.value&&(u[y.monitorItem[a]].max.value=i,u[y.monitorItem[a]].max.time=e[n].timeStamp),(void 0===s.min.value||i<s.min.value)&&(u[y.monitorItem[a]].min.value=i,u[y.monitorItem[a]].min.time=e[n].timeStamp),u[y.monitorItem[a]].sum+=i);return angular.forEach(u,function(e,n){0!==e.countHasData&&(e.average=e.sum/e.countHasData),t?"%"==t?(e.min={text:r(e.min.value,2,t),tip:m(e.min.time)},e.max={text:r(e.max.value,2,t),tip:m(e.max.time)},e.average={text:r(e.average,2,t)}):(e.min={text:o(e.min.value,t),tip:m(e.min.time)},e.max={text:o(e.max.value,t),tip:m(e.max.time)},e.average={text:o(e.average,t)}):(e.min={text:e.min.value,tip:m(e.min.time)},e.max={text:e.max.value,tip:m(e.max.time)},e.average={text:e.average}),"container"==y.monitorType&&(n=n.substring(0,12)),l[0][n]=e.min,l[1][n]=e.max,l[2][n]=e.average}),l}function u(e,t){var n,a,i,s,u=0,l=e.length,c=!1,d=[];for(n=l-1;n>=0&&u<v.tableLength;n--){if(i=e[n],s={},!c)for(a=0;a<y.monitorItem.length;a++){var f=i[y.monitorItem[a]];if(null!==f&&void 0!==f){c=!0;break}}if(c){for(s.key={text:m(e[n].timeStamp)},a=0;a<y.monitorItem.length;a++){var p="container"===y.monitorType?y.monitorItem[a].substring(0,12):y.monitorItem[a];"%"==t?s[p]={text:r(e[n][y.monitorItem[a]],2,"%")}:s[p]={text:o(e[n][y.monitorItem[a]],t)}}d.push(s),u++}}return d}function l(e,t,n,a){t.head=v.tableHead,t.item=v.tableItem,e?t.body=s(n,a):t.body=u(n,a)}function c(e,t){var n;for(n=e.length-4;n>=0;n--)if(void 0!==e[n][t]&&null!==e[n][t])return n;return-1}function d(e,t,n){return e&&e[t]?e[t][n]:void 0}function m(e){return void 0!==e&&null!==e?a("date")(e,"yyyy-MM-dd HH:mm:ss"):void 0}function f(e,t){if(!t)return t;for(var n=angular.copy(t),a=0;a<n.length;a++)for(var i=0;i<e.length;i++){var r=n[a][e[i]];null===r||void 0===r||isNaN(r)||(n[a][e[i]]=r.toFixed(2))}return n}function p(e,t,a){if(!t)return t;for(var i=angular.copy(t),r=0;r<i.length;r++)for(var o=0;o<e.length;o++)i[r][e[o]]&&(i[r][e[o]]=n.formartBytesData(i[r][e[o]],a).toFixed(2));return i}function h(e,t,n){var a,i,s,u={value:0,time:void 0},l={value:void 0,time:void 0},c=0,d=0,f=0;if(e&&void 0!==n){for(a=0;a<e.length;a++)i=e[a][n],null!==i&&void 0!==i&&(f++,i>u.value&&(u.value=i,u.time=e[a].timeStamp),(void 0===l.value||i<l.value)&&(l.value=i,l.time=e[a].timeStamp),d+=i);return 0!==f&&(c=d/f),s=t?"%"==t?{max:{text:r(u.value,2,t),tip:m(u.time)},min:{text:r(l.value,2,t),tip:m(l.time)},average:{text:r(c,2,t)}}:{max:{text:o(u.value,t),tip:m(u.time)},min:{text:o(l.value,t),tip:m(l.time)},average:{text:o(c,t)}}:{max:{text:r(u.value,2),tip:m(u.time)},min:{text:r(l.value,2),tip:m(l.time)},average:{text:r(d/e.length,2)}}}}function g(e,t){for(var n=[{key:{text:"最小值"}},{key:{text:"最大值"}},{key:{text:"平均值"}}],a=1;a<e.length;a++){var i=t[e[a]]||{min:{text:"——"},max:{text:"——"},average:{text:"——"}};n[0][e[a]]=i.min,n[1][e[a]]=i.max,n[2][e[a]]=i.average}return n}var v,y,b,D=this;i(),D.getAmchartConfig=function(e,t,n){var a={type:"serial",categoryField:"timeStamp",pathToImages:"/lib/images/amcharts/",zoomOutButtonAlpha:.26,startDuration:0,chartScrollbar:{},chartCursor:{categoryBalloonDateFormat:"JJ:NN:SS"},categoryAxis:{minPeriod:"ss",parseDates:!0,labelOffset:6,offset:1,equalSpacing:!0},graphs:[],titles:[{id:"Title-1",size:15,text:e}],dataProvider:t,trendLines:[],guides:[],valueAxes:[],allLabels:[],balloon:{}};""===e&&(a.titles=[]);for(var i=0;i<y.monitorItem.length;i++)a.graphs.push({bullet:"round",id:"AmGraph"+i,title:y.monitorItem[i],bulletField:y.monitorItem[i],balloonText:"[["+y.monitorItem[i]+"]]"+n,valueField:y.monitorItem[i]}),a.legend={useGraphSettings:!0,valueWidth:120,valueText:"[[value]]"+n};return a},D.getMonitorsArr=function(e,t,n,a){var s,u,x,k,M,I,C,w=v.tableLength,S=[],T=[],A=v.tableKeyName=a?"统计值":"时间";if(i(),t.length<2&&(u=t[0]),S=function(){var e=angular.copy(t);return e.unshift(A),e}(),T=angular.copy(t),"container"==e.targetType){for(s=0;s<T.length;s++)T[s]=T[s].substring(0,12);for(s=1;s<S.length;s++)S[s]=S[s].substring(0,12)}if(T.unshift("key"),v.tableItem=T,v.tableHead=S,y.monitorItem=t,y.monitorType=n.targetType,"node"==n.targetType){if(n.counterResults["cpu.busy"]){if(I=n.counterResults["cpu.busy"],M={head:[],item:[],body:[]},void 0!==u){if(M.head=[A,"busy","user","nice","system","iowait","irq","softirq","switches"],M.item=["key","busy","user","nice","system","iowait","irq","softirq","switches"],a)C={busy:h(I,"%",u),user:h(n.counterResults["cpu.user"],"%",u),nice:h(n.counterResults["cpu.nice"],"%",u),system:h(n.counterResults["cpu.system"],"%",u),iowait:h(n.counterResults["cpu.iowait"],"%",u),irq:h(n.counterResults["cpu.irq"],"%",u),softirq:h(n.counterResults["cpu.softirq"],"%",u),switches:h(n.counterResults["cpu.switches"],"",u)},M.body=g(M.item,C);else if(x=c(I,u),-1!==x)for(k=x-w;x>=0&&x>k;x--)M.body.push({key:{text:m(d(I,x,"timeStamp"))},busy:{text:r(d(I,x,u),2,"%")},user:{text:r(d(n.counterResults["cpu.user"],x,u),2,"%")},nice:{text:r(d(n.counterResults["cpu.nice"],x,u),2,"%")},system:{text:r(d(n.counterResults["cpu.system"],x,u),2,"%")},iowait:{text:r(d(n.counterResults["cpu.iowait"],x,u),2,"%")},irq:{text:r(d(n.counterResults["cpu.irq"],x,u),2,"%")},softirq:{text:r(d(n.counterResults["cpu.softirq"],x,u),2,"%")},switches:{text:r(d(n.counterResults["cpu.switches"],x,u),2)}})}else l(a,M,I,"%");b.cpu={chartData:D.getAmchartConfig("CPU使用率(%)",f(t,I),"%"),tableData:M}}angular.forEach(n.counterResults,function(e,i){var s=i.split("=")[1];if(s)if(-1!==i.indexOf("df.bytes.used.percent/")){if(M={head:[],item:[],body:[]},void 0!==u){if(M.head=[A,"磁盘占用(GB)","磁盘总量(GB)","磁盘占用率"],M.item=["key","mountused","mounttotal","mountpercent"],a)C={mountused:h(n.counterResults["df.bytes.used/mount="+s],"GB",u),mounttotal:h(n.counterResults["df.bytes.total/mount="+s],"GB",u),mountpercent:h(e,"%",u)},M.body=g(M.item,C);else if(x=c(e,u),-1!==x)for(k=x-w;x>=0&&x>k;x--)M.body.push({key:{text:m(d(e,x,"timeStamp"))},mountpercent:{text:r(d(e,x,u),2,"%")},mountused:{text:o(d(n.counterResults["df.bytes.used/mount="+s],x,u),"GB")},mounttotal:{text:o(d(n.counterResults["df.bytes.total/mount="+s],x,u),"GB")}})}else l(a,M,e,"%");b.diskUsedMult.push({name:s,chartData:D.getAmchartConfig("",f(t,e),"%"),tableData:M})}else if(-1!==i.indexOf("disk.io.read_bytes/")||-1!==i.indexOf("disk.io.write_bytes/")){var v=-1!==i.indexOf("disk.io.read_bytes/");if(M={head:[],item:[],body:[]},void 0!==u){if(M.head=v?[A,"读取数据(KB/s)"]:[A,"写入数据(KB/s)"],M.item=["key","data"],a)C={data:h(e,"KB",u)},M.body=g(M.item,C);else if(x=c(e,u),-1!==x)for(k=x-w;x>=0&&x>k;x--)M.body.push({key:{text:m(d(e,x,"timeStamp"))},data:{text:o(d(e,x,u),"KB")}})}else l(a,M,e,"KB");v?b.diskReadMult.push({name:s,chartData:D.getAmchartConfig("",p(t,e,"KB"),"KB/s"),tableData:M}):b.diskWriteMult.push({name:s,chartData:D.getAmchartConfig("",p(t,e,"KB"),"KB/s"),tableData:M})}else if(-1!==i.indexOf("net.if.out.bytes/")||-1!==i.indexOf("net.if.in.bytes/")){var y=-1!==i.indexOf("net.if.out.bytes/");if(M={head:[],item:[],body:[]},void 0!==u){if(M.head=y?[A,"流出数据(KB/s)"]:[A,"流入数据(KB/s)"],M.item=["key","netdata"],a)C={netdata:h(e,"KB",u)},M.body=g(M.item,C);else if(x=c(e,u),-1!==x)for(k=x-w;x>=0&&x>k;x--)M.body.push({key:{text:m(d(e,x,"timeStamp"))},netdata:{text:o(d(e,x,u),"KB")}})}else l(a,M,e,"KB");y?b.netOutMult.push({name:s,chartData:D.getAmchartConfig("",p(t,e,"KB"),"KB/s"),tableData:M}):b.netInMult.push({name:s,chartData:D.getAmchartConfig("",p(t,e,"KB"),"KB/s"),tableData:M})}})}else{if(n.counterResults["container.cpu.usage.busy"]){if(I=n.counterResults["container.cpu.usage.busy"],M={head:[],item:[],body:[]},void 0!==u){if(M.head=[A,"busy","user","system"],M.item=["key","busy","user","system"],a)C={busy:h(I,"%",u),user:h(n.counterResults["container.cpu.usage.user"],"%",u),system:h(n.counterResults["container.cpu.usage.system"],"%",u)},M.body=g(M.item,C);else if(x=c(I,u),-1!==x)for(k=x-w;x>=0&&x>k;x--)M.body.push({key:{text:m(d(n.counterResults["container.cpu.usage.busy"],x,"timeStamp"))},busy:{text:r(d(n.counterResults["container.cpu.usage.busy"],x,u),2,"%")},user:{text:r(d(n.counterResults["container.cpu.usage.user"],x,u),2,"%")},system:{text:r(d(n.counterResults["container.cpu.usage.system"],x,u),2,"%")}})}else l(a,M,I,"%");b.cpu={chartData:D.getAmchartConfig("CPU占用率(%)",f(t,I),"%"),tableData:M}}angular.forEach(["container.net.if.in.bytes","container.net.if.out.bytes"],function(e){if(n.counterResults[e]){var i="container.net.if.in.bytes"===e;if(I=n.counterResults[e],M={head:[],item:[],body:[]},void 0!==u){if(M.head=i?[A,"流入数据(KB/s)"]:[A,"流出数据(KB/s)"],M.item=["key","netdata"],a)C={netdata:h(I,"KB",u)},M.body=g(M.item,C);else if(x=c(I,u),-1!==x)for(k=x-w;x>=0&&x>k;x--)M.body.push({key:{text:m(d(I,x,"timeStamp"))},netdata:{text:o(d(I,x,u),"KB")}})}else l(a,M,I,"KB");i?b.netIn={chartData:D.getAmchartConfig("网络流入(KB/s)",p(t,I,"KB"),"KB/s"),tableData:M}:b.netOut={chartData:D.getAmchartConfig("网络流出(KB/s)",p(t,I,"KB"),"KB/s"),tableData:M}}})}if(n.counterResults["mem.memused.percent"]||n.counterResults["container.mem.usage.percent"]){M={head:[],item:[],body:[]};var R,$,B;if(n.counterResults["mem.memused.percent"]?(R=n.counterResults["mem.memused.percent"],$=n.counterResults["mem.memtotal"],B=n.counterResults["mem.memused"]):(R=n.counterResults["container.mem.usage.percent"],$=n.counterResults["container.mem.limit"],B=n.counterResults["container.mem.usage"]),void 0!==u){if(n.counterResults["mem.memused.percent"]?M.head=[A,"内存占用量(MB)","内存总量(MB)","内存占用率"]:M.head=[A,"内存占用量(MB)","内存限额(MB)","内存占用率"],M.item=["key","memused","memtotal","mempercent"],a)C={memused:h(B,"MB",u),memtotal:h($,"MB",u),mempercent:h(R,"%",u)},M.body=g(M.item,C);else if(x=c(R,u),-1!==x)for(k=x-w;x>=0&&x>k;x--)M.body.push({key:{text:m(d(R,x,"timeStamp"))},memused:{text:o(d(B,x,u),"MB")},memtotal:{text:o(d($,x,u),"MB")},mempercent:{text:r(d(R,x,u),2,"%")}})}else l(a,M,R,"%");b.mem={chartData:D.getAmchartConfig("内存占用率(%)",f(t,R),"%"),tableData:M}}return b},D.getMonitor=function(t){return e.get("/api/monitor/data/"+t.targetId+"?start="+t.start+"&end="+t.end+"&dataSpec="+t.dataSpec+"&cid="+t.cid)}}]),monitorApp.controller("MonitorCtr",["$scope","$http","$util","$monitor","$q","$timeout","$domePublic",function(e,t,n,a,i,r,o){"use strict";e.sampleTypes=[{type:"MIN",text:"最小值"},{type:"MAX",text:"最大值"},{type:"AVERAGE",text:"平均值"}];var s=n.getQueryString("id"),u=n.getQueryString("cid");e.clusterName=n.getQueryString("cname"),e.singleItem=!1,e.monitorItem=[],e.monitorTypeName="",e.isLoading=!0,e.isRealTime=!1;var l,c=function(){var n=i.defer();return e.targetInfos?n.resolve(e.targetInfos):t.get("/api/monitor/target/"+s+"?cid="+u).then(function(t){e.targetInfos=t.data.result,e.monitorItem=[];var a,i=e.targetInfos.targetInfos;switch(e.targetInfos.targetType){case"node":for(e.monitorTypeName="主机",e.singleItem=i[0].node,a=0;a<i.length;a++)e.monitorItem.push(i[a].node);break;case"pod":for(e.monitorTypeName="实例",e.singleItem=i[0].pod.podName,a=0;a<i.length;a++)e.monitorItem.push(i[a].pod.podName);break;case"container":for(e.monitorTypeName="容器",e.singleItem=i[0].container.containerId.substring(0,12),a=0;a<i.length;a++)e.monitorItem.push(i[a].container.containerId);break;default:e.singleItem=!1}e.monitorItem.length>1&&(e.singleItem=!1),n.resolve(e.targetInfos)},function(e){o.openWarning({title:"请求失败！",msg:"Message:"+e.data.resultMsg}),n.reject()}),n.promise};c(),e.date={},e.intervalTime=0,e.monitorsInfo={cpu:{chartData:[]},mem:{chartData:[]},diskUsedMult:[],diskWriteMult:[],diskReadMult:[],netInMult:[],netOutMult:[],netIn:{chartData:[]},netOut:{chartData:[]}},e.selectedMonitor={diskUsedMult:{name:"",chartData:[],tableData:{}},diskReadMult:{name:"",chartData:[],tableData:{}},diskWriteMult:{name:"",chartData:[],tableData:{}},netInMult:{name:"",chartData:[],tableData:{}},netOutMult:{name:"",chartData:[],tableData:{}}},e.currentSampleType=e.sampleTypes[2];var d=function(t){var n=!1;if(e.selectedMonitor[t])if(""!==e.selectedMonitor[t].name){for(var a=0;a<e.monitorsInfo[t].length;a++)e.monitorsInfo[t][a].name===e.selectedMonitor[t].name&&(n=!0,e.toggleSelectedMonitor(t,a));n||e.toggleSelectedMonitor(t,0)}else e.toggleSelectedMonitor(t,0)},m=function(){l&&r.cancel(l),c().then(function(){var t={targetId:s,start:e.date.startDate,end:e.date.endDate,dataSpec:e.currentSampleType.type,cid:u};a.getMonitor(t).then(function(n){var i=n.data.result||{};(!i.interval||i.interval<5)&&(i.interval=5),e.intervalTime=1e3*i.interval,e.monitorsInfo=null,e.monitorsInfo=angular.copy(a.getMonitorsArr(t,e.monitorItem,i,!e.isRealTime)),d("diskUsedMult"),d("diskReadMult"),d("diskWriteMult"),d("netInMult"),d("netOutMult"),e.isRealTime&&(l=r(function(){e.date.endDate=(new Date).getTime(),e.date.startDate=e.date.endDate-36e5,m()},e.intervalTime))})["finally"](function(){e.isLoading=!1})},function(){e.isLoading=!1})};e.toggleSelectedMonitor=function(t,n){e.monitorsInfo[t]&&(e.selectedMonitor[t]=e.monitorsInfo[t][n])},e.toggleSampleType=function(t){e.isLoading=!0,e.currentSampleType=e.sampleTypes[t],m()},e.$on("dateIntervalChange",function(t,n){e.date=n,e.isLoading=!0,e.date.endDate-(new Date).getTime()<2e3&&e.date.endDate-e.date.startDate<37e5?e.isRealTime=!0:e.isRealTime=!1,m()})}]);