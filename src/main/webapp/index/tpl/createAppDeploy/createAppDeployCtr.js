'use strict';

/*
 * @author ChandraLee
 */

(function (domeApp, undefined) {
	'use strict';

	if (typeof domeApp === 'undefined') return;
	domeApp.controller('CreateAppDeployCtr', ['$scope', '$domeAppStore', '$domeCluster', '$domeUser', '$state', '$stateParams', '$domePublic', function ($scope, $domeAppStore, $domeCluster, $domeUser, $state, $stateParams, $domePublic) {
		if (!$stateParams.appName) {
			$state.go('appStore');
		}
		$scope.$emit('pageTitle', {
			title: $stateParams.appName,
			descrition: '',
			mod: 'appStore'
		});
		var appData = void 0;
		var nodeService = $domeCluster.getInstance('NodeService');
		$domeAppStore.getStoreApps().then(function (res) {
			var isExist = false;
			if (res.data) {
				for (var i = 0, l = res.data.length; i < l; i++) {
					if (res.data[i].appName === $stateParams.appName) {
						isExist = true;
						appData = res.data[i];
						break;
					}
				}
				if (!isExist) {
					$domePublic.openWarning('无相关应用数据');
					$state.go('appStore');
				} else {
					var logDraft = {
						logItemDrafts: []
					};
					var logPathList = appData.deploymentTemplate.logPathList;
					if (!logPathList) {
						logPathList = [];
					}
					for (var j = 0, l1 = logPathList.length; j < l1; j++) {
						logDraft.logItemDrafts.push({
							logPath: logPathList[j],
							autoCollect: false,
							autoDelete: false
						});
					}
					appData.deploymentTemplate.logPathList = void 0;
					// 转换为部署需要的日志格式
					appData.deploymentTemplate.logDraft = logDraft;
					appData.deploymentTemplate.networkMode = 'DEFAULT';
					$scope.appInfoIns = $domeAppStore.getInstance('AppInfo', appData);
					$scope.config = $scope.appInfoIns.config;
					$scope.deployIns = $scope.appInfoIns.deployIns;
					$scope.deployConfig = $scope.deployIns.config;
					nodeService.getData().then(function (res) {
						$scope.deployIns.clusterListIns.init(res.data.result);
						$scope.deployIns.toggleCluster();
					});
					// $domeUser.userService.getGroupList().then(function(res) {
					// 	$scope.deployIns.userGroupListIns.init(res.data.result);
					// }).finally(function() {});
				}
			} else {
				$domePublic.openWarning('请求失败！');
				$state.go('appStore');
			}
		}, function () {
			$domePublic.openWarning('请求失败！');
			$state.go('appStore');
		});

		$scope.createDeploy = function () {
			$scope.isLoading = true;
			$scope.deployIns.create().then(function () {
				$domePublic.openPrompt('创建成功！');
				$state.go('deployManage');
			}, function (res) {
				if (res.type == 'namespace') {
					$domePublic.openWarning({
						title: '创建namespace失败！',
						msg: 'Msg:' + res.msg
					});
				} else {
					$domePublic.openWarning({
						title: '创建失败！',
						msg: 'Msg:' + res.msg
					});
				}
			}).finally(function () {
				$scope.isLoading = false;
			});
		};
	}]);
})(window.domeApp);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4L3RwbC9jcmVhdGVBcHBEZXBsb3kvY3JlYXRlQXBwRGVwbG95Q3RyLmVzIl0sIm5hbWVzIjpbImRvbWVBcHAiLCJ1bmRlZmluZWQiLCJjb250cm9sbGVyIiwiJHNjb3BlIiwiJGRvbWVBcHBTdG9yZSIsIiRkb21lQ2x1c3RlciIsIiRkb21lVXNlciIsIiRzdGF0ZSIsIiRzdGF0ZVBhcmFtcyIsIiRkb21lUHVibGljIiwiYXBwTmFtZSIsImdvIiwiJGVtaXQiLCJ0aXRsZSIsImRlc2NyaXRpb24iLCJtb2QiLCJhcHBEYXRhIiwibm9kZVNlcnZpY2UiLCJnZXRJbnN0YW5jZSIsImdldFN0b3JlQXBwcyIsInRoZW4iLCJyZXMiLCJpc0V4aXN0IiwiZGF0YSIsImkiLCJsIiwibGVuZ3RoIiwib3Blbldhcm5pbmciLCJsb2dEcmFmdCIsImxvZ0l0ZW1EcmFmdHMiLCJsb2dQYXRoTGlzdCIsImRlcGxveW1lbnRUZW1wbGF0ZSIsImoiLCJsMSIsInB1c2giLCJsb2dQYXRoIiwiYXV0b0NvbGxlY3QiLCJhdXRvRGVsZXRlIiwibmV0d29ya01vZGUiLCJhcHBJbmZvSW5zIiwiY29uZmlnIiwiZGVwbG95SW5zIiwiZGVwbG95Q29uZmlnIiwiZ2V0RGF0YSIsImNsdXN0ZXJMaXN0SW5zIiwiaW5pdCIsInJlc3VsdCIsInRvZ2dsZUNsdXN0ZXIiLCJjcmVhdGVEZXBsb3kiLCJpc0xvYWRpbmciLCJjcmVhdGUiLCJvcGVuUHJvbXB0IiwidHlwZSIsIm1zZyIsImZpbmFsbHkiLCJ3aW5kb3ciXSwibWFwcGluZ3MiOiI7O0FBQUE7Ozs7QUFJQSxDQUFDLFVBQVVBLE9BQVYsRUFBbUJDLFNBQW5CLEVBQThCO0FBQzlCOztBQUNBLEtBQUksT0FBT0QsT0FBUCxLQUFtQixXQUF2QixFQUFvQztBQUNwQ0EsU0FBUUUsVUFBUixDQUFtQixvQkFBbkIsRUFBeUMsQ0FBQyxRQUFELEVBQVcsZUFBWCxFQUE0QixjQUE1QixFQUE0QyxXQUE1QyxFQUF5RCxRQUF6RCxFQUFtRSxj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a0IsV0FBWixDQUF3QixPQUF4QjtBQUNBcEIsVUFBT0ksRUFBUCxDQUFVLFVBQVY7QUFDQSxHQW5ERDs7QUFxREFSLFNBQU82QyxZQUFQLEdBQXNCLFlBQVk7QUFDakM3QyxVQUFPOEMsU0FBUCxHQUFtQixJQUFuQjtBQUNBOUMsVUFBT3NDLFNBQVAsQ0FBaUJTLE1BQWpCLEdBQTBCOUIsSUFBMUIsQ0FBK0IsWUFBWTtBQUMxQ1gsZ0JBQVkwQyxVQUFaLENBQXVCLE9BQXZCO0FBQ0E1QyxXQUFPSSxFQUFQLENBQVUsY0FBVjtBQUNBLElBSEQsRUFHRyxVQUFVVSxHQUFWLEVBQWU7QUFDakIsUUFBSUEsSUFBSStCLElBQUosSUFBWSxXQUFoQixFQUE2QjtBQUM1QjNDLGlCQUFZa0IsV0FBWixDQUF3QjtBQUN2QmQsYUFBTyxnQkFEZ0I7QUFFdkJ3QyxXQUFLLFNBQVNoQyxJQUFJZ0M7QUFGSyxNQUF4QjtBQUlBLEtBTEQsTUFLTztBQUNONUMsaUJBQVlrQixXQUFaLENBQXdCO0FBQ3ZCZCxhQUFPLE9BRGdCO0FBRXZCd0MsV0FBSyxTQUFTaEMsSUFBSWdDO0FBRkssTUFBeEI7QUFJQTtBQUNELElBZkQsRUFlR0MsT0FmSCxDQWVXLFlBQVk7QUFDdEJuRCxXQUFPOEMsU0FBUCxHQUFtQixLQUFuQjtBQUNBLElBakJEO0FBa0JBLEdBcEJEO0FBcUJBLEVBckZ3QyxDQUF6QztBQXNGQSxDQXpGRCxFQXlGR00sT0FBT3ZELE9BekZWIiwiZmlsZSI6ImluZGV4L3RwbC9jcmVhdGVBcHBEZXBsb3kvY3JlYXRlQXBwRGVwbG95Q3RyLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLypcbiAqIEBhdXRob3IgQ2hhbmRyYUxlZVxuICovXG5cbihmdW5jdGlvbiAoZG9tZUFwcCwgdW5kZWZpbmVkKSB7XG5cdCd1c2Ugc3RyaWN0Jztcblx0aWYgKHR5cGVvZiBkb21lQXBwID09PSAndW5kZWZpbmVkJykgcmV0dXJuO1xuXHRkb21lQXBwLmNvbnRyb2xsZXIoJ0NyZWF0ZUFwcERlcGxveUN0cicsIFsnJHNjb3BlJywgJyRkb21lQXBwU3RvcmUnLCAnJGRvbWVDbHVzdGVyJywgJyRkb21lVXNlcicsICckc3RhdGUnLCAnJHN0YXRlUGFyYW1zJywgJyRkb21lUHVibGljJywgZnVuY3Rpb24gKCRzY29wZSwgJGRvbWVBcHBTdG9yZSwgJGRvbWVDbHVzdGVyLCAkZG9tZVVzZXIsICRzdGF0ZSwgJHN0YXRlUGFyYW1zLCAkZG9tZVB1YmxpYykge1xuXHRcdGlmICghJHN0YXRlUGFyYW1zLmFwcE5hbWUpIHtcblx0XHRcdCRzdGF0ZS5nbygnYXBwU3RvcmUnKTtcblx0XHR9XG5cdFx0JHNjb3BlLiRlbWl0KCdwYWdlVGl0bGUnLCB7XG5cdFx0XHR0aXRsZTogJHN0YXRlUGFyYW1zLmFwcE5hbWUsXG5cdFx0XHRkZXNjcml0aW9uOiAnJyxcblx0XHRcdG1vZDogJ2FwcFN0b3JlJ1xuXHRcdH0pO1xuXHRcdGxldCBhcHBEYXRhO1xuXHRcdGNvbnN0IG5vZGVTZXJ2aWNlID0gJGRvbWVDbHVzdGVyLmdldEluc3RhbmNlKCdOb2RlU2VydmljZScpO1xuXHRcdCRkb21lQXBwU3RvcmUuZ2V0U3RvcmVBcHBzKCkudGhlbihmdW5jdGlvbiAocmVzKSB7XG5cdFx0XHRsZXQgaXNFeGlzdCA9IGZhbHNlO1xuXHRcdFx0aWYgKHJlcy5kYXRhKSB7XG5cdFx0XHRcdGZvciAobGV0IGkgPSAwLCBsID0gcmVzLmRhdGEubGVuZ3RoOyBpIDwgbDsgaSsrKSB7XG5cdFx0XHRcdFx0aWYgKHJlcy5kYXRhW2ldLmFwcE5hbWUgPT09ICRzdGF0ZVBhcmFtcy5hcHBOYW1lKSB7XG5cdFx0XHRcdFx0XHRpc0V4aXN0ID0gdHJ1ZTtcblx0XHRcdFx0XHRcdGFwcERhdGEgPSByZXMuZGF0YVtpXTtcblx0XHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0XHRpZiAoIWlzRXhpc3QpIHtcblx0XHRcdFx0XHQkZG9tZVB1YmxpYy5vcGVuV2FybmluZygn5peg55u45YWz5bqU55So5pWw5o2uJyk7XG5cdFx0XHRcdFx0JHN0YXRlLmdvKCdhcHBTdG9yZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGxldCBsb2dEcmFmdCA9IHtcblx0XHRcdFx0XHRcdGxvZ0l0ZW1EcmFmdHM6IFtdXG5cdFx0XHRcdFx0fTtcblx0XHRcdFx0XHRsZXQgbG9nUGF0aExpc3QgPSBhcHBEYXRhLmRlcGxveW1lbnRUZW1wbGF0ZS5sb2dQYXRoTGlzdDtcblx0XHRcdFx0XHRpZiAoIWxvZ1BhdGhMaXN0KSB7XG5cdFx0XHRcdFx0XHRsb2dQYXRoTGlzdCA9IFtdO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRmb3IgKGxldCBqID0gMCwgbDEgPSBsb2dQYXRoTGlzdC5sZW5ndGg7IGogPCBsMTsgaisrKSB7XG5cdFx0XHRcdFx0XHRsb2dEcmFmdC5sb2dJdGVtRHJhZnRzLnB1c2goe1xuXHRcdFx0XHRcdFx0XHRsb2dQYXRoOiBsb2dQYXRoTGlzdFtqXSxcblx0XHRcdFx0XHRcdFx0YXV0b0NvbGxlY3Q6IGZhbHNlLFxuXHRcdFx0XHRcdFx0XHRhdXRvRGVsZXRlOiBmYWxzZVxuXHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGFwcERhdGEuZGVwbG95bWVudFRlbXBsYXRlLmxvZ1BhdGhMaXN0ID0gdm9pZCAwO1xuXHRcdFx0XHRcdC8vIOi9rOaNouS4uumDqOe9sumcgOimgeeahOaXpeW/l+agvOW8j1xuXHRcdFx0XHRcdGFwcERhdGEuZGVwbG95bWVudFRlbXBsYXRlLmxvZ0RyYWZ0ID0gbG9nRHJhZnQ7XG5cdFx0XHRcdFx0YXBwRGF0YS5kZXBsb3ltZW50VGVtcGxhdGUubmV0d29ya01vZGUgPSAnREVGQVVMVCc7XG5cdFx0XHRcdFx0JHNjb3BlLmFwcEluZm9JbnMgPSAkZG9tZUFwcFN0b3JlLmdldEluc3RhbmNlKCdBcHBJbmZvJywgYXBwRGF0YSk7XG5cdFx0XHRcdFx0JHNjb3BlLmNvbmZpZyA9ICRzY29wZS5hcHBJbmZvSW5zLmNvbmZpZztcblx0XHRcdFx0XHQkc2NvcGUuZGVwbG95SW5zID0gJHNjb3BlLmFwcEluZm9JbnMuZGVwbG95SW5zO1xuXHRcdFx0XHRcdCRzY29wZS5kZXBsb3lDb25maWcgPSAkc2NvcGUuZGVwbG95SW5zLmNvbmZpZztcblx0XHRcdFx0XHRub2RlU2VydmljZS5nZXREYXRhKCkudGhlbihmdW5jdGlvbiAocmVzKSB7XG5cdFx0XHRcdFx0XHQkc2NvcGUuZGVwbG95SW5zLmNsdXN0ZXJMaXN0SW5zLmluaXQocmVzLmRhdGEucmVzdWx0KTtcblx0XHRcdFx0XHRcdCRzY29wZS5kZXBsb3lJbnMudG9nZ2xlQ2x1c3RlcigpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdC8vICRkb21lVXNlci51c2VyU2VydmljZS5nZXRHcm91cExpc3QoKS50aGVuKGZ1bmN0aW9uKHJlcykge1xuXHRcdFx0XHRcdC8vIFx0JHNjb3BlLmRlcGxveUlucy51c2VyR3JvdXBMaXN0SW5zLmluaXQocmVzLmRhdGEucmVzdWx0KTtcblx0XHRcdFx0XHQvLyB9KS5maW5hbGx5KGZ1bmN0aW9uKCkge30pO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQkZG9tZVB1YmxpYy5vcGVuV2FybmluZygn6K+35rGC5aSx6LSl77yBJyk7XG5cdFx0XHRcdCRzdGF0ZS5nbygnYXBwU3RvcmUnKTtcblx0XHRcdH1cblx0XHR9LCBmdW5jdGlvbiAoKSB7XG5cdFx0XHQkZG9tZVB1YmxpYy5vcGVuV2FybmluZygn6K+35rGC5aSx6LSl77yBJyk7XG5cdFx0XHQkc3RhdGUuZ28oJ2FwcFN0b3JlJyk7XG5cdFx0fSk7XG5cblx0XHQkc2NvcGUuY3JlYXRlRGVwbG95ID0gZnVuY3Rpb24gKCkge1xuXHRcdFx0JHNjb3BlLmlzTG9hZGluZyA9IHRydWU7XG5cdFx0XHQkc2NvcGUuZGVwbG95SW5zLmNyZWF0ZSgpLnRoZW4oZnVuY3Rpb24gKCkge1xuXHRcdFx0XHQkZG9tZVB1YmxpYy5vcGVuUHJvbXB0KCfliJvlu7rmiJDlip/vvIEnKTtcblx0XHRcdFx0JHN0YXRlLmdvKCdkZXBsb3lNYW5hZ2UnKTtcblx0XHRcdH0sIGZ1bmN0aW9uIChyZXMpIHtcblx0XHRcdFx0aWYgKHJlcy50eXBlID09ICduYW1lc3BhY2UnKSB7XG5cdFx0XHRcdFx0JGRvbWVQdWJsaWMub3Blbldhcm5pbmcoe1xuXHRcdFx0XHRcdFx0dGl0bGU6ICfliJvlu7puYW1lc3BhY2XlpLHotKXvvIEnLFxuXHRcdFx0XHRcdFx0bXNnOiAnTXNnOicgKyByZXMubXNnXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0JGRvbWVQdWJsaWMub3Blbldhcm5pbmcoe1xuXHRcdFx0XHRcdFx0dGl0bGU6ICfliJvlu7rlpLHotKXvvIEnLFxuXHRcdFx0XHRcdFx0bXNnOiAnTXNnOicgKyByZXMubXNnXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH0pLmZpbmFsbHkoZnVuY3Rpb24gKCkge1xuXHRcdFx0XHQkc2NvcGUuaXNMb2FkaW5nID0gZmFsc2U7XG5cdFx0XHR9KTtcblx0XHR9O1xuXHR9XSk7XG59KSh3aW5kb3cuZG9tZUFwcCk7Il19
