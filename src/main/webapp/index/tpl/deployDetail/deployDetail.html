
<div class="mod-deploy deploy-detail">
  <div class="detail-header">
    <div class="detail-item"><em class="item-name">所在集群</em><b class="item-content" ng-bind="config.clusterName"></b></div><i class="detail-sep"></i>
    <div class="detail-item"><em class="item-name">namespace</em><b class="item-content" ng-bind="config.namespace"></b></div><i class="detail-sep"></i>
    <div class="detail-item"><em class="item-name">部署类型</em><b class="item-content" ng-bind="config.deployTypeShow"></b></div><i class="detail-sep"></i>
    <div class="detail-item"><em class="item-name">上次升级时间</em><b class="item-content" ng-bind="vmDome.parseDate(config.lastUpdateTime)"></b></div><i class="detail-sep"></i>
    <div class="detail-item"><em class="item-name">实例个数</em><b class="item-content" ng-bind="config.currentReplicas"></b></div><i class="detail-sep"></i>
    <div class="detail-item"><em class="item-name">当前版本</em><b class="item-content" ng-if="!config.currentVersions||config.currentVersions.length===0">无</b><b class="item-content" ng-repeat="version in config.currentVersions" ng-cloak="ng-cloak">version{{version.version}}</b></div><i class="detail-sep"></i>
    <div class="detail-item"><em class="item-name">状态</em><b class="item-content" ng-switch="config.deploymentStatus"><span class="txt-success" ng-switch-when="RUNNING">运行中</span><span class="txt-error" ng-switch-when="STOP">停止</span><span class="txt-primary" ng-switch-when="DEPLOYING">部署中</span><span class="txt-warning" ng-switch-when="ERROR">异常</span><span class="txt-primary" ng-switch-when="STOPPING">停止中</span><span class="txt-primary" ng-switch-when="UPDATING">升级中</span><span class="txt-primary" ng-switch-when="BACKROLLING">回滚中</span><span class="txt-primary" ng-switch-when="UPSCALING">扩容中</span><span class="txt-primary" ng-switch-when="DOWNSCALING">缩容中</span><span class="txt-warning" ng-switch-when="ABORTING">中断中</span><span class="txt-warning" ng-switch-when="BACKROLL_ABORTED">回滚已中断</span><span class="txt-warning" ng-switch-when="UPDATE_ABORTED">升级已中断</span></b></div>
    <div class="deploy-option pull-right tool-align-input" ng-switch="config.deploymentStatus" ng-if="isEdit"><span ng-switch-when="RUNNING">
        <button class="ui-btn ui-btn-bright ui-btn-lg" ng-disabled="isWaitingUpVersion" ng-click="updateVersion()" ng-if="!config.stateful">升级/回滚</button>
        <button class="ui-btn ui-btn-bright ui-btn-lg" ng-disabled="isWaitingScale" ng-click="scaleVersion()" ng-if="!config.stateful">扩容/缩容</button>
        <button class="ui-btn ui-btn-bright ui-btn-sm" ng-disabled="isWaitingStop" ng-click="stopVersion()">停止</button></span><span ng-switch-when="STOP">
        <button class="ui-btn ui-btn-bright ui-btn-sm" ng-disabled="isWaitingStart" ng-click="startVersion()">启动</button>
        <button class="ui-btn ui-btn-bright ui-btn-sm" ng-class="{'ui-btn-lg-disabled':!isDelete}" ng-disabled="!isDelete" ng-click="deleteDeploy()">删除</button></span><span ng-if="config.deploymentStatus=='ERROR'||config.deploymentStatus=='BACKROLL_ABORTED'||config.deploymentStatus=='UPDATE_ABORTED'">
        <button class="ui-btn ui-btn-bright ui-btn-sm" ng-if="!config.stateful" ng-disabled="isWaitingRecover" ng-click="recover()">恢复</button>
        <button class="ui-btn ui-btn-bright ui-btn-sm" ng-disabled="isWaitingStop" ng-click="stopVersion()">停止</button></span>
      <button class="ui-btn ui-btn-bright ui-btn-lg" ng-switch-when="DEPLOYING" ng-disabled="isWaitingOperation" ng-click="abortDeploy('DEPLOYING')" ng-if="config.deploymentType !== 'DAEMONSET'">中断启动</button>
      <button class="ui-btn ui-btn-bright ui-btn-lg" ng-switch-when="UPDATING" ng-disabled="isWaitingOperation" ng-click="abortDeploy('UPDATING')" ng-if="config.deploymentType !== 'DAEMONSET'">中断升级</button>
      <button class="ui-btn ui-btn-bright ui-btn-lg" ng-switch-when="BACKROLLING" ng-disabled="isWaitingOperation" ng-click="abortDeploy('BACKROLLING')" ng-if="config.deploymentType !== 'DAEMONSET'">中断回滚</button>
      <button class="ui-btn ui-btn-bright ui-btn-lg" ng-switch-when="UPSCALING" ng-disabled="isWaitingOperation" ng-click="abortDeploy('UPSCALING')" ng-if="config.deploymentType !== 'DAEMONSET'">中断扩容</button>
      <button class="ui-btn ui-btn-bright ui-btn-lg" ng-switch-when="DOWNSCALING" ng-disabled="isWaitingOperation" ng-click="abortDeploy('DOWNSCALING')" ng-if="config.deploymentType !== 'DAEMONSET'">中断缩容</button>
      <button class="ui-btn ui-btn-bright ui-btn-lg" ng-switch-when="DEPLOYING" ng-disabled="isWaitingOperation" ng-click="stopVersion()" ng-if="config.deploymentType === 'DAEMONSET'">停止部署</button>
      <button class="ui-btn ui-btn-bright ui-btn-lg" ng-switch-when="UPDATING" ng-disabled="isWaitingOperation" ng-click="stopVersion()" ng-if="config.deploymentType === 'DAEMONSET'">停止部署</button>
      <button class="ui-btn ui-btn-bright ui-btn-lg" ng-switch-when="BACKROLLING" ng-disabled="isWaitingOperation" ng-click="stopVersion()" ng-if="config.deploymentType === 'DAEMONSET'">停止部署</button>
      <button class="ui-btn ui-btn-bright ui-btn-lg" ng-switch-when="UPSCALING" ng-disabled="isWaitingOperation" ng-click="stopVersion()" ng-if="config.deploymentType === 'DAEMONSET'">停止部署</button>
      <button class="ui-btn ui-btn-bright ui-btn-lg" ng-switch-when="DOWNSCALING" ng-disabled="isWaitingOperation" ng-click="stopVersion()" ng-if="config.deploymentType === 'DAEMONSET'">停止部署</button>
    </div>
  </div>
  <loading ng-if="isLoading=(loadingsIns.isLoading||(tabActive[0].active&amp;&amp;deployIns.loadingIns.isLoading)||(tabActive[1].active&amp;&amp;deployEditIns.loadingIns.isLoading))"></loading>
  <tabset>
    <tab heading="部署详情" active="tabActive[0].active" ui-sref="deployDetail.detail">
      <div class="deploy-info">
        <div class="deploy-rollback" ng-if="config.volumeDrafts[0].name">
          <div class="mod-title-name">存储设置</div>
        </div>
        <ul class="com-list-info mirror-con" ng-if="config.volumeDrafts[0].name">
          <li ng-repeat-start="volume in (config.volumeDrafts)" ng-if="volume.name"><span class="info-name">类型</span>
            <div class="info-content info-content-lg-height"><span class="first-info" ng-bind="deployIns.mountVolumeType[volume.volumeType]"></span></div>
          </li>
          <li ng-if="volume.name"><span class="info-name">名称</span>
            <div class="info-content info-content-lg-height"><span class="first-info" ng-bind="volume.name"></span></div>
          </li>
          <li class="has-border" ng-show="volume.volumeType === 'HOSTPATH'"><span class="info-name">主机目录</span>
            <div class="info-content info-content-lg-height"><span class="first-info" ng-bind="volume.hostPath"></span></div>
          </li>
        </ul>
        <div class="deploy-rollback"><span class="mod-title-name" ng-if="!config.stateful">部署版本</span><span class="mod-title-name" ng-if="config.stateful">该部署是有状态服务，只有一个部署版本</span>
          <div class="com-select-con" select-con="select-con">
            <button class="ui-btn ui-btn-select ui-btn-white"><i class="icon-down"></i>{{deployIns.config.version?'version'+deployIns.config.version:'选择版本'}}</button>
            <ul class="select-list">
              <li class="select-item" ng-repeat="version in deployIns.versionList"><a ng-click="toggleVersion(version.version)" ng-cloak="ng-cloak">version{{version.version}}</a></li>
            </ul>
          </div>
        </div>
        <ul class="com-list-info mirror-con" ng-repeat="containerDraft in config.containerDrafts" ng-show="config.version">
          <li><span class="info-name">镜像名称</span>
            <div class="info-content info-content-lg-height"><span class="first-info" ng-bind="containerDraft.image" style="font-weight:bold;"></span></div>
          </li>
          <li><span class="info-name">镜像仓库</span>
            <div class="info-content info-content-lg-height"><span class="first-info" ng-bind="containerDraft.registry"></span></div>
          </li>
          <li><span class="info-name">镜像版本</span>
            <div class="info-content info-content-lg-height"><span class="first-info" ng-bind="containerDraft.tag"></span></div>
          </li>
          <li><span class="info-name">自动部署</span>
            <div class="info-content info-content-lg-height first-info" ng-switch="containerDraft.autoDeploy"><span ng-switch-when="true">已开启自动部署</span><span ng-switch-default="ng-switch-default">未开启自动部署</span></div>
          </li>
          <li ng-if="containerDraft.volumeMountDrafts.length"><span class="info-name">存储挂载</span>
            <div class="info-content info-content-lg-height">
              <div class="line-long" ng-cloak="ng-cloak" ng-repeat="volumeMount in containerDraft.volumeMountDrafts"><span class="small-info">名称：{{volumeMount.name}}</span><span class="small-info">访问权限：{{ ({false:'读写', true:'只读'}[volumeMount.readOnly]) }} </span><span class="small-info">路径：{{volumeMount.mountPath}}</span></div>
            </div>
          </li>
          <li><span class="info-name">是否已废弃</span>
            <div class="info-content info-content-lg-height"><span>{{config.deprecate?'是':'否'}}</span></div>
          </li>
          <li><span class="info-name">运行过程环境变量</span>
            <div class="info-content info-content-lg-height">
              <div class="line-long"><span class="first-info" ng-if="!containerDraft.oldEnv||(containerDraft.oldEnv.length===0&amp;&amp;containerDraft.newEnv.length===0)">未设置</span>
                <table class="ui-table-primary ui-table-env" ng-hide="!containerDraft.oldEnv||(containerDraft.oldEnv.length===0&amp;&amp;containerDraft.newEnv.length===0)">
                  <thead>
                    <tr>
                      <th>环境变量名</th>
                      <th>环境变量值</th>
                      <th>描述</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr ng-repeat="env in containerDraft.oldEnv">
                      <td ng-bind="env.key"></td>
                      <td ng-bind="env.value"></td>
                      <td ng-bind="env.description"></td>
                    </tr>
                    <tr ng-repeat="env in containerDraft.newEnv">
                      <td ng-bind="env.key"></td>
                      <td ng-bind="env.value"></td>
                      <td ng-cloak="ng-cloak">{{env.description||'无'}}</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </li>
          <li><span class="info-name">容器大小</span>
            <div class="info-content info-content-lg-height" ng-cloak="ng-cloak">
              <div class="first-info"><span class="small-info">CPU：{{containerDraft.cpu}}个</span><span class="small-info">内存：{{containerDraft.mem}}MB</span></div>
            </div>
          </li>
          <li><span class="info-name">镜像拉取策略</span>
            <div class="info-content info-content-lg-height first-info" ng-switch="containerDraft.imagePullPolicy"><span ng-switch-default="ng-switch-default">Always</span><span ng-switch-when="Never">Never</span><span ng-switch-when="IfNotPresent">If Not Present</span></div>
          </li>
          <li><span class="info-name">健康检查</span>
            <div class="info-content info-content-lg-height first-info" ng-switch="containerDraft.healthChecker.type"><span ng-switch-default="ng-switch-default">None</span><span ng-switch-when="HTTP">HTTP检查</span><span ng-switch-when="TCP">TCP检查</span>
              <div class="health-info" ng-if="containerDraft.healthChecker.type=='TCP'||containerDraft.healthChecker.type=='HTTP'"><span>检查端口:</span><span class="tool-next" ng-bind="containerDraft.healthChecker.port"></span></div>
              <div class="health-info" ng-if="containerDraft.healthChecker.type=='TCP'||containerDraft.healthChecker.type=='HTTP'"><span>超时时间（s）:</span><span class="tool-next" ng-cloak="ng-cloak">{{containerDraft.healthChecker.timeout}}</span></div>
              <div class="health-info" ng-if="containerDraft.healthChecker.type=='TCP'||containerDraft.healthChecker.type=='HTTP'"><span>首次检测延迟（s）:</span><span class="tool-next" ng-cloak="ng-cloak">{{containerDraft.healthChecker.delay}}</span></div>
              <div class="health-info" ng-if="containerDraft.healthChecker.type=='HTTP'"><span>检测URL:</span><span class="tool-next" ng-bind="containerDraft.healthChecker.url"></span></div>
              <div class="health-info" ng-if="containerDraft.healthChecker.type=='HTTP'"><span>允许返回值:</span><span class="tool-next">200-400(不包含400)</span></div>
            </div>
          </li>
          <li><span class="info-name">日志</span>
            <div class="info-content info-content-lg-height"><span class="first-info" ng-if="containerDraft.logItemDrafts.length===1">未设置</span>
              <ul class="log-info first-info" ng-cloak="ng-cloak">
                <li ng-repeat="logDraft in containerDraft.logItemDrafts" ng-hide="$last"><span class="log-path">日志路径:{{logDraft.logPath}}</span><span>自动收集日志:{{logDraft.autoCollect?'开启':'未开启'}}</span><span ng-if="logDraft.autoCollect"><span>日志Topic：{{logDraft.logTopic}}</span><span>预处理命令：{{logDraft.processCmd||'未设置'}}<a class="icon-help" style="margin-left:10px;" popover="对收集到的日志做进一步处理，比如筛选或增减字段等，可以用grep和awk命令完成，命令以管道形式执行，因此必须以“|”开始，比如一个典型的处理命令为：   | grep &quot;ERROR\\|WARN\\| EXCEPTION\\| statistic&quot; | awk -vnhost=&quot;$HOSTNAME&quot; '{print &quot;[&quot;nhost&quot;]--&quot;$0}'，该命令将只筛选包含四个对应关键字的行，并且会在行首添加&quot;[hostname]--&quot;的字符串，参照可完成其他复杂的处理方式"></a></span></span><span>自动删除日志:{{logDraft.autoDelete?'开启':'未开启'}}</span><span ng-if="logDraft.autoDelete">过期时间：{{logDraft.logExpired}}小时</span></li>
              </ul>
            </div>
          </li>
        </ul>
        <h4 class="mod-title">部署设置</h4>
        <ul class="com-list-info mirror-con">
          <li ng-if="config.stateful"><span class="info-name">网络模式</span>
            <div class="info-content info-content-lg-height" ng-switch="config.networkMode"><span class="first-info" ng-switch-when="HOST">Host</span><span class="first-info" ng-switch-default="ng-switch-default">默认</span></div>
          </li>
          <li><span class="info-name">部署类型</span>
            <div class="info-content info-content-lg-height">
              <div ng-cloak="ng-cloak"><span class="small-info">{{showdeploy.deployTypeShow}}</span></div>
            </div>
          </li>
          <li><span class="info-name">筛选主机</span>
            <div class="info-content info-content-lg-height">
              <div ng-cloak="ng-cloak"><span>集群：{{deployIns.clusterListIns.cluster.name}}</span><span class="tool-next">部署环境：{{deployIns.envText}}</span></div>
              <div class="line-long" ng-if="config.stateful"><span class="tool-align-input">所选主机：</span>
                <div class="host-txt-con line-element com-select-con" select-con="select-con">
                  <ul class="selected-labels">
                    <li class="select-label" ng-repeat="host in config.hostList" ng-bind="host"></li>
                  </ul>
                </div>
              </div>
              <div class="line-long" ng-if="!config.stateful &amp;&amp; (showdeploy.versionType || 'CUSTOM') === 'CUSTOM'"><span class="tool-align-input">主机标签：</span>
                <div class="host-txt-con line-element com-select-con" select-con="select-con">
                  <ul class="selected-labels">
                    <li class="select-label" ng-repeat="(label,value) in deployIns.nodeListIns.labelsInfo|search:'isSelected':true|search:'isShow':true" ng-cloak="ng-cloak">{{label}}</li>
                  </ul>
                </div><span class="txt-wrap"><a class="link-safe" ng-click="deployIns.nodeListIns.showHost()">查看选中主机</a></span>
              </div>
            </div>
          </li>
          <li ng-if="(showdeploy.versionType || 'CUSTOM') === 'CUSTOM'"><span class="info-name">网络模式</span>
            <div class="info-content info-content-lg-height">
              <div ng-cloak="ng-cloak"><span class="small-info">{{showdeploy.networkMode=='HOST'?'Host':'Overlay'}}</span></div>
            </div>
          </li>
          <li><span class="info-name">部署描述</span>
            <div class="info-content info-content-lg-height">
              <div class="line-long">
                <div ng-cloak="ng-cloak"><span ng-if="!isEditDesc" ng-bind="config.description || '无描述信息'"></span>
                  <textarea class="ui-input-fill" ng-if="isEditDesc" ng-model="editDescription.text" style="width: 450px; resize: vertical;"></textarea>
                </div>
                <div ng-if="isEdit" style="margin-left: 10px;">
                  <button class="fa fa-pencil ui-btn-none icon-edit-color" ng-if="!isEditDesc" ng-click="toggleIsEditDesc()" tooltip="修改" style="padding:0 5px !important;"></button>
                  <button class="fa fa-floppy-o ui-btn-none icon-success-color enlarge-foucs" ng-if="isEditDesc" ng-click="saveDescription()" tooltip="保存" style="padding:0 5px !important;"></button>
                  <button class="fa fa-times ui-btn-none icon-cancel-color enlarge-foucs" ng-if="isEditDesc" ng-click="toggleIsEditDesc()" tooltip="取消" style="padding:0 5px !important;">  </button>
                </div>
              </div>
            </div>
          </li>
          <li ng-if="showdeploy.versionType === 'JSON' || showdeploy.versionType === 'YAML'"><span class="info-name" ng-if="showdeploy.versionType === 'YAML'">YAML配置</span><span class="info-name" ng-if="showdeploy.versionType === 'JSON'">JSON配置</span>
            <div class="info-content code-area" ng-bind="config.versionString.deploymentStr"> </div>
          </li>
        </ul>
      </div>
    </tab>
    <tab heading="升级" active="tabActive[1].active" ng-if="!config.stateful" ui-sref="deployDetail.update">
      <div class="deploy-info" ng-form="ng-form" role="form" name="deployForm" ng-class="{'need-valid':valid.needValid}">
        <div class="info-content" ng-if="editConfig.versionType === 'YAML' || editConfig.versionType === 'JSON'">
          <ul class="com-list-info">
            <li class="yaml-container"><span class="info-name" ng-if="editConfig.versionType === 'YAML'">YAML配置</span><span class="info-name" ng-if="editConfig.versionType === 'JSON'">JSON配置</span>
              <div class="info-content info-content-lg-height">
                <label class="config-input-group-label">
                  <div class="config-input-group">
                    <div class="config-input-group-top code-area" ng-bind="editConfig.versionString.deploymentStrHead"></div>
                    <div class="config-input-group-textarea-tip"><a ng-click="setPodStrToDefault()" href="javascript:void 0;" ng-if="podStrUndoText === null &amp;&amp; editConfig.versionType === 'YAML'">YAML配置样例</a><a ng-click="setPodStrToDefault()" href="javascript:void 0;" ng-if="podStrUndoText === null &amp;&amp; editConfig.versionType === 'JSON'">JSON配置样例</a><a ng-click="undoPodStrToDefault()" href="javascript:void 0;" ng-if="podStrUndoText !== null">撤销</a></div>
                    <textarea class="ui-input-fill ui-input-group-vertical-middle code-area" ng-model="editConfig.versionString.podSpecStr" ng-change="clearPodStrUndoText()" style="width: calc(100% - {{editConfig.versionString.indent + 2}}ch); margin-left: {{editConfig.versionString.indent + 2}}ch;"></textarea>
                    <div class="config-input-group-bottom code-area" ng-bind="editConfig.versionString.deploymentStrTail"></div>
                  </div>
                </label>
              </div>
            </li>
          </ul>
        </div>
        <div class="image-container" ng-if="(editConfig.versionType || 'CUSTOM') === 'CUSTOM'">
          <div class="mod-title-name">存储设置</div>
        </div>
        <ul class="com-list-info mirror-con" ng-repeat="volume in editConfig.volumeDrafts">
          <li class="cancel"><a class="icon-cancel cancel-log volume-delete-icon" ng-click="deployEditIns.deleteVolumeDraft(volume, editConfig.containerDrafts)"></a></li>
          <li><span class="info-name">类别</span>
            <div class="info-content">
              <div class="com-select-con" select-con="select-con">
                <button class="ui-btn ui-btn-white ui-btn-select volume-input" ng-cloak="ng-cloak"><i class="icon-down"></i>{{deployIns.mountVolumeType[volume.volumeType]}}</button>
                <ul class="select-list volume-input">
                  <li class="select-item" ng-repeat="mountType in ['HOSTPATH', 'EMPTYDIR']"><a ng-click="deployEditIns.toggleVolumeType(volume, mountType)"><span>{{deployIns.mountVolumeType[mountType]}}</span></a></li>
                </ul>
              </div><span class="txt-prompt" ng-if="volume.volumeType === 'HOSTPATH'" style="margin-left:12px;">该类别会将主机目录挂载到容器内部，实例调度后存在于主机目录的文件不会回收</span><span class="txt-prompt" ng-if="volume.volumeType === 'EMPTYDIR'" style="margin-left:12px;">该类别创建的存储，可以被示例内容器共同访问，当实例调度时，存储内容会被回收</span>
            </div>
          </li>
          <li><span class="info-name">名称</span>
            <div class="info-content">
              <input class="ui-input-fill volume-input" name="volumename" ng-model="volume.name" ng-change="deployEditIns.updateVolumeMountName(volume, editConfig.containerDrafts)" required="required"/><span class="txt-prompt" style="margin-left:12px;">名称在该部署内唯一不可重复</span>
            </div>
          </li>
          <li ng-if="volume.volumeType === 'HOSTPATH'"><span class="info-name">主机目录</span>
            <div class="info-content">
              <input class="ui-input-fill volume-input" name="volumepath" ng-model="volume.hostPath" pattern="^/.*"/><span class="txt-prompt" style="margin-left:12px;">需要填写绝对路径</span>
            </div>
          </li>
        </ul>
        <div class="image-container">
          <button class="ui-btn ui-btn-sm ui-btn-active add-log" ng-click="deployEditIns.addVolumeDraft()">添加</button><span class="txt-prompt" style="margin-left:12px;">如果需要在容器中挂载存储，需要先在此处进行配置</span>
        </div>
        <div class="image-container" ng-if="(editConfig.versionType || 'CUSTOM') === 'CUSTOM'"><span class="mod-title-name">镜像设置</span>
          <div class="com-select-con add-mirror" select-con="select-con">
            <input class="ui-input-white ui-btn-select input-image" placeholder="添加镜像" ng-model="imageKey"/>
            <ul class="select-list">
              <li class="select-item" ng-repeat="image in deployEditIns.imageList|filter:{'imageName':imageKey}"><a ng-click="deployEditIns.addImage(image);imageKey=''">{{image.imageName}}<span class="txt-prompt pull-right">{{image.registry}}</span></a></li>
            </ul>
          </div>
        </div>
        <ul class="com-list-info mirror-con mirror-collapse" ng-repeat="containerDraft in editConfig.containerDrafts" ng-form="ng-form" name="childForm" mirror-collapse="mirror-collapse" ng-init="imageindex=$index;">
          <li class="cancel"><a class="icon-cancel" ng-click="deployEditIns.deleteImage($index)"></a></li>
          <li class="down" ng-click="toggleCollapse()"><i class="icon-down-double" ng-class="{'up':!isCollapse}"></i></li>
          <li><span class="info-name">镜像仓库</span>
            <div class="info-content info-content-lg-height"><span class="first-info" ng-bind="containerDraft.registry"></span></div>
          </li>
          <li><span class="info-name">镜像名称</span>
            <div class="info-content info-content-lg-height"><span class="first-info txt-bright" ng-bind="containerDraft.image" style="font-weight:bold;"></span></div>
          </li>
          <li><span class="info-name">镜像版本</span>
            <div class="info-content">
              <div class="line-short com-select-con" select-con="select-con">
                <button class="ui-btn ui-btn-white ui-btn-select" ng-cloak="ng-cloak"><i class="icon-down"></i>{{containerDraft.tag}}</button>
                <ul class="select-list">
                  <li ng-if="!containerDraft.tagList||containerDraft.tagList.length===0"><a>无版本信息</a></li>
                  <li class="select-item" ng-repeat="tag in containerDraft.tagList"><a ng-click="deployEditIns.toggleImageTag($parent.$index,tag.tag)"><span class="txt-prompt image-tag" ng-bind="vmDome.parseDate(tag.createTime)"></span><span ng-bind="tag.tag"></span></a></li>
                </ul>
              </div>
            </div>
          </li>
          <li ng-show="!isCollapse"><span class="info-name">自动部署</span>
            <div class="info-content">
              <dome-toggle ng-class="{'on':containerDraft.autoDeploy}" ng-click="containerDraft.autoDeploy=!containerDraft.autoDeploy" ng-model="containerDraft.autoDeploy"></dome-toggle><span class="txt-prompt"> 开启后，通过项目构建产生该镜像的新版本时，会自动触发该部署升级。该功能只对运行中的部署有效。</span>
            </div>
          </li>
          <li ng-if="editConfig.volumeDrafts.length &gt; 0"><span class="info-name">存储挂载</span>
            <div class="info-content">
              <ul class="volume-list">
                <li class="line-long" ng-repeat="volumeMount in containerDraft.volumeMountDrafts">
                  <div class="com-select-con line-element" select-con="select-con">
                    <button class="ui-btn ui-btn-white ui-btn-select" ng-cloak="ng-cloak"><i class="icon-down"></i>{{ volumeMount.name || '选择存储' }}</button>
                    <ul class="select-list">
                      <li class="select-item" ng-repeat="volume in editConfig.volumeDrafts"><a ng-click="deployEditIns.toggleVolumeMountName(volumeMount, volume)"><span>{{ volume.name }}</span></a></li>
                    </ul>
                  </div>
                  <div class="com-select-con line-element next-item" select-con="select-con" style="margin-left:10px;">
                    <button class="ui-btn ui-btn-white ui-btn-select" ng-cloak="ng-cloak"><i class="icon-down"></i>{{ ({false:'读写', true:'只读'}[volumeMount.readOnly]) }}</button>
                    <ul class="select-list">
                      <li class="select-item" ng-repeat="accessControl in [true, false]"><a ng-click="deployEditIns.toggleVolumeMountReadonly(volumeMount, accessControl)"><span>{{ ({false:'读写', true:'只读'}[accessControl]) }}</span></a></li>
                    </ul>
                  </div>
                  <input class="line-element next-item ui-input-fill" placeholder="路径" name="path" ng-model="volumeMount.mountPath" style="margin-left:10px;"/>
                  <button class="txt-wrap delete-icon fa fa-trash-o ui-btn-none icon-trash-color" ng-click="deployIns.deleteVolumeMountDraft(containerDraft, volumeMount)" style="width:20px;"></button>
                </li><span class="add-env line-long" ng-click="deployEditIns.addVolumeMountDraft(containerDraft)"><i class="icon-add"></i></span>
              </ul>
            </div>
          </li>
          <li ng-show="!isCollapse"><span class="info-name">运行过程环境变量</span>
            <div class="info-content">
              <div class="line-long">
                <table class="ui-table-primary ui-table-env" ng-show="containerDraft.oldEnv.length!==0">
                  <thead>
                    <tr>
                      <th>环境变量名</th>
                      <th>环境变量值</th>
                      <th>描述</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr ng-repeat="env in containerDraft.oldEnv">
                      <td ng-bind="env.key"></td>
                      <th class="txt-cell">
                        <input class="ui-input-fill" ng-model="env.value" placeholder="环境变量值"/>
                      </th>
                      <td ng-bind="env.description"></td>
                    </tr>
                  </tbody>
                </table>
              </div>
              <div class="line-long new-volume-list" ng-repeat="env in containerDraft.newEnv" style="margin: 0 0 10px;">
                <input class="ui-input-fill line-element" ng-model="env.key" placeholder="环境变量名" is-required="is-required" param1="env.value" ng-pattern="/^[A-Za-z_][A-Za-z0-9_]*$/"/>
                <input class="ui-input-fill line-element" ng-model="env.value" placeholder="环境变量值" is-required="is-required" param1="env.key" style="margin-left:10px;"/>
                <input class="ui-input-fill line-element" ng-model="env.description" placeholder="描述20字以内" style="margin-left:10px;"/>
                <button class="txt-wrap delete-icon fa fa-trash-o ui-btn-none icon-trash-color" ng-click="deployEditIns.deleteImageEnv($parent.$index,$index)" style="width:20px;"></button>
              </div><span class="add-env" ng-click="deployEditIns.addImageEnv($index)"><i class="icon-add"></i></span>
            </div>
          </li>
          <li ng-show="!isCollapse"><span class="info-name info-name-content-for-label">容器大小</span>
            <div class="info-content">CPU（个）
              <input class="ui-input-fill ui-input-sm" ng-model="containerDraft.cpu" name="cpu" ng-pattern="/^(\d*\.)?\d+$/" required="required"/>内存（MB）
              <input class="ui-input-fill ui-input-sm" ng-model="containerDraft.mem" name="mem" ng-pattern="/^(\d*\.)?\d+$/" required="required"/><span class="tool-inline-error" ng-if="(valid.needValid||childForm.cpu.$dirty)&amp;&amp;childForm.cpu.$invalid||(valid.needValid||childForm.mem.$dirty)&amp;&amp;childForm.mem.$invalid">请填写数字</span>
            </div>
          </li>
          <li ng-show="!isCollapse"><span class="info-name info-name-content-for-label">镜像拉取策略</span>
            <div class="info-content info-name-content-for-label">
              <dome-radio class="com-check-con" d-id="{{'pullPolicyAlways_'+$index}}" d-value="'Always'" d-name="pullPolicyType{{$index}}" d-label="Always" d-model="containerDraft.imagePullPolicy"></dome-radio>
              <dome-radio class="com-check-con" d-id="{{'pullPolicyNever_'+$index}}" d-value="'Never'" d-name="pullPolicyType{{$index}}" d-label="Never" d-model="containerDraft.imagePullPolicy"></dome-radio>
              <dome-radio class="com-check-con" d-id="{{'pullPolicyIfNotPresent_'+$index}}" d-value="'IfNotPresent'" d-name="pullPolicyType{{$index}}" d-label="If Not Present" d-model="containerDraft.imagePullPolicy"></dome-radio>
            </div>
          </li>
          <li ng-show="!isCollapse"><span class="info-name tool-align-input">健康检查</span>
            <div class="info-content info-content-lg-height">
              <dome-radio class="com-check-con" ng-if="editConfig.networkMode!=='HOST'" d-id="{{'checkNONE_'+$index}}" d-value="'NONE'" d-name="healthCheckerType{{$index}}" d-label="None" d-model="containerDraft.healthChecker.type"></dome-radio>
              <dome-radio class="com-check-con" ng-if="editConfig.networkMode!=='HOST'" d-id="{{'checkTCP_'+$index}}" d-value="'TCP'" d-name="healthCheckerType{{$index}}" d-disabled="{{editConfig.networkMode=='HOST'}}" d-label="TCP检查" d-model="containerDraft.healthChecker.type"></dome-radio>
              <dome-radio class="com-check-con" ng-if="editConfig.networkMode!=='HOST'" d-id="{{'checkHTTP_'+$index}}" d-value="'HTTP'" d-name="healthCheckerType{{$index}}" d-disabled="{{editConfig.networkMode=='HOST'}}" d-label="HTTP检查" d-model="containerDraft.healthChecker.type"></dome-radio>
              <p class="txt-prompt" ng-if="editConfig.networkMode=='HOST'">Host网络模式下不能使用健康检查</p>
              <div class="line-long" ng-if="containerDraft.healthChecker.type=='TCP'||containerDraft.healthChecker.type=='HTTP'"><span class="child-name">检查端口</span>
                <input class="ui-input-fill line-element" placeholder="请输入端口号" name="port" ng-model="containerDraft.healthChecker.port" required="required"/>
              </div><span class="child-error txt-error" ng-if="(valid.needValid||childForm.port.$dirty)&amp;&amp;childForm.port.$invalid">必填</span>
              <div class="line-long" ng-if="containerDraft.healthChecker.type=='TCP'||containerDraft.healthChecker.type=='HTTP'"><span class="child-name">超时时间（s）</span>
                <input class="ui-input-fill line-element" placeholder="超过时间达到规定阈值，则健康检查判定为异常" name="timeout" ng-model="containerDraft.healthChecker.timeout" required="required" ng-pattern="/^[1-9]\d*$/"/>
              </div><span class="child-error txt-error" ng-if="(valid.needValid||childForm.timeout.$dirty)&amp;&amp;childForm.timeout.$invalid">请填写数字</span>
              <div class="line-long" ng-if="containerDraft.healthChecker.type=='TCP'||containerDraft.healthChecker.type=='HTTP'"><span class="child-name">首次检测延迟（s）</span>
                <input class="ui-input-fill line-element" placeholder="容器启动后延迟规定秒数，再开始健康检查" name="delay" ng-model="containerDraft.healthChecker.delay" required="required" ng-pattern="/^[1-9]\d*$/"/>
              </div><span class="child-error txt-error" ng-if="(valid.needValid||childForm.delay.$dirty)&amp;&amp;childForm.delay.$invalid">请填写数字</span>
              <div class="line-long" ng-if="containerDraft.healthChecker.type=='HTTP'"><span class="child-name">检测URL</span>
                <input class="ui-input-fill line-element" placeholder="请输入URL" name="url" ng-model="containerDraft.healthChecker.url" required="required"/>
              </div><span class="child-error txt-error" ng-if="(valid.needValid||childForm.url.$dirty)&amp;&amp;childForm.url.$invalid">必填</span>
              <div class="line-long" ng-if="containerDraft.healthChecker.type=='HTTP'"><span class="child-name">允许返回值</span><span class="child-txt"> 200-400(不包含400)</span></div>
            </div>
            <li ng-show="!isCollapse"><span class="info-name info-name-lg">日志</span>
              <div class="info-content">
                <p class="txt-prompt no-log" ng-if="!deployIns.logConfig">所选集群没有开启日志自动收集。不能进行日志相关配置。</p>
                <div class="log-item" ng-form="ng-form" ng-repeat="log in containerDraft.logItemDrafts" name="childForm" ng-if="deployIns.logConfig"><a class="icon-cancel cancel-log" ng-click="deployEditIns.deleteLogDraft(containerDraft, log)"></a>
                  <input class="ui-input-fill element-full" placeholder="请输入日志路径，不能放在根目录下" ng-pattern="/^/.*[^/]$/" ng-model="log.logPath" name="logPath" is-required="is-required" param1="{{log.autoCollect&amp;&amp;log.logTopic}}" param2="{{log.autoCollect&amp;&amp;log.processCmd}}" param3="{{log.autoDelete&amp;&amp;log.logExpired}}"/><span class="txt-error" ng-if="childForm.logPath.$dirty&amp;&amp;childForm.logPath.$error.pattern">非法的格式</span>
                  <div class="log-check">
                    <input class="ui-check" id="autoCollect_{{imageindex}}_{{$index}}" type="checkbox" name="autoCollect" ng-model="log.autoCollect"/>
                    <label for="autoCollect_{{imageindex}}_{{$index}}">自动收集日志</label>
                  </div>
                  <div class="line-full" ng-if="log.autoCollect"><span class="log-title"> 日志topic</span>
                    <input class="ui-input-fill line-element" placeholder="请输入日志topic" name="logTopic" ng-model="log.logTopic" required="required"/>
                  </div>
                  <div class="line-full" ng-if="log.autoCollect"><span class="log-title"> 预处理命令</span>
                    <div class="line-element">
                      <input class="ui-input-fill full" placeholder="请输入预处理命令" name="processCmd" ng-model="log.processCmd"/><span class="txt-wrap"><a class="icon-help" popover="对收集到的日志做进一步处理，比如筛选或增减字段等，可以用grep和awk命令完成，命令以管道形式执行，因此必须以“|”开始，比如一个典型的处理命令为：   | grep &quot;ERROR\\|WARN\\| EXCEPTION\\| statistic&quot; | awk -vnhost=&quot;$HOSTNAME&quot; '{print &quot;[&quot;nhost&quot;]--&quot;$0}'，该命令将只筛选包含四个对应关键字的行，并且会在行首添加&quot;[hostname]--&quot;的字符串，参照可完成其他复杂的处理方式"></a></span>
                    </div>
                  </div>
                  <div class="log-check">
                    <input class="ui-check" id="autoDelete_{{imageindex}}_{{$index}}" type="checkbox" name="autoDelete" ng-model="log.autoDelete"/>
                    <label for="autoDelete_{{imageindex}}_{{$index}}">自动删除日志</label>
                  </div>
                  <div class="line-full" ng-if="log.autoDelete"><span class="log-title"> 过期时间</span>
                    <input class="ui-input-fill" placeholder="过期则自动删除" name="logExpired" ng-model="log.logExpired" required="required" ng-pattern="/^[1-9]\d*$/"/><span class="unit">小时</span>
                  </div>
                  <div class="txt-error log-error" ng-if="(valid.needValid||deployForm.logExpired.$dirty)&amp;&amp;deployForm.logExpired.$invalid">请输入大于0的整数</div>
                </div>
                <button class="ui-btn ui-btn-sm ui-btn-active add-log" ng-click="deployEditIns.addLogDraft(containerDraft)" ng-if="deployIns.logConfig">添加</button>
              </div>
            </li>
          </li>
        </ul>
        <div class="mod-title" ng-if="(editConfig.versionType  || 'CUSTOM') === 'CUSTOM'">部署设置</div>
        <ul class="com-list-info mirror-con" ng-if="(editConfig.versionType  || 'CUSTOM') === 'CUSTOM'">
          <li><span class="info-name">筛选主机</span>
            <div class="info-content">
              <div class="line-short">
                <div class="com-select-con line-element" select-con="select-con">
                  <button class="ui-btn ui-btn-white ui-btn-select" disabled="true"><i class="icon-down"></i>{{deployEditIns.clusterListIns.cluster.name}}</button>
                </div>
                <div class="com-select-con line-element tool-next" select-con="select-con">
                  <button class="ui-btn ui-btn-white ui-btn-select" ng-cloak="ng-cloak" disabled="true"><i class="icon-down"></i>{{deployEditIns.envText}}</button>
                  <input type="hidden" ng-model="editConfig.hostEnv" name="hostEnv" required="required"/><span class="txt-error" ng-if="(valid.needValid||deployForm.hostEnv.$dirty)&amp;&amp;deployForm.hostEnv.$invalid">请选择部署环境</span>
                </div>
              </div>
              <div class="line-long">
                <div class="ui-input-white host-txt-con com-select-con" label="true" select-con="select-con">
                  <ul class="selected-labels">
                    <li class="select-label" ng-repeat="(label,value) in deployEditIns.nodeListIns.labelsInfo|search:'isSelected':true|search:'isShow':true" ng-cloak="ng-cloak">{{label}}<a class="icon-cancel" ng-click="deployEditIns.nodeListIns.toggleLabel(label,false)"></a></li>
                    <li class="select-input">
                      <input class="line-element ui-btn-select" placeholder="选择主机标签" ng-model="labelKey.key" ng-keydown="labelKeyDown($event,labelKey.key,labelsInfoFiltered)"/>
                    </li>
                  </ul>
                  <ul class="select-list">
                    <li ng-if="vmDome.objLength(labelsInfoFiltered)===0"><a>无相关信息</a></li>
                    <li class="select-item" ng-repeat="(label,value) in labelsInfoFiltered=(deployEditIns.nodeListIns.labelsInfo | searchKey:labelKey.key|search:'isShow':true)"><a ng-bind="label" ng-click="deployEditIns.nodeListIns.toggleLabel(label,true);labelKey.key='';"></a></li>
                  </ul>
                </div><span class="txt-wrap"><a class="link-safe" ng-click="deployEditIns.nodeListIns.showHost()">查看选中主机</a></span>
              </div>
            </div>
          </li>
          <li><span class="info-name">网络模式</span>
            <div class="info-content info-content-lg-height"><span class="first-info">{{showdeploy.networkMode=='HOST'?'Host':'Overlay'}}</span></div>
          </li>
        </ul>
        <div class="com-bottom-option"><span class="span com-bottom-option-con">
            <button class="ui-btn ui-btn-sm ui-btn-bright" ng-class="{'ui-btn-lg-disabled':!isEdit}" ng-disabled="!isEdit||isWaitingUpdate||isLoading" ng-click="valid.needValid=true;deployForm.$valid&amp;&amp;toUpdate();">保存升级设置</button>
            <div class="txt-error" ng-show="valid.needValid&amp;&amp;deployForm.$invalid">存在不合法数据，请修改后提交。</div></span></div>
      </div>
    </tab>
    <tab heading="事件" active="tabActive[2].active" ng-click="getEvents()" ui-sref="deployDetail.event">
      <div class="events-con">
        <ul class="events-list">
          <li class="event-success" ng-if="eventList.length===0">无事件信息</li>
          <li ng-repeat="event in eventList" ng-class="{'START':'event-building','PROCESSING':'event-building','SUCCESS':'event-success','FAILED':'event-failed','KUBERNETES':'event-system','ABORTED':'event-system','null':'event-system','undefined':'event-system'}[event.eventStatus]"><span class="icon-dot"><i class="dot-line"></i></span><span class="event-name" ng-bind="event.optTxt"></span><span class="event-result" ng-bind="event.statusTxt"></span><span class="event-date" ng-bind="vmDome.parseDate(event.startTime)"></span><span class="event-author" ng-cloak="ng-cloak"><i class="icon-user" tooltip="操作者"></i>{{event.userName}}</span><span class="event-process" ng-if="event.operation!='KUBERNETES'"><span class="event-process-item" tooltip="起始状态" tooltip-placement="left"><i class="icon-process-dot start"></i>
                <div class="event-process-detail"><span class="sig-event-process" ng-repeat="status in event.primarySnapshot" ng-bind="status.version+' , '+status.replicas"></span></div></span><span class="event-process-item" tooltip="目标状态" tooltip-placement="left"><i class="icon-process-dot origin"></i>
                <div class="event-process-detail"><span class="sig-event-process" ng-repeat="status in event.targetSnapshot" ng-bind="status.version+' , '+status.replicas"></span></div></span><span class="event-process-item" tooltip="完成状态" tooltip-placement="left"><i class="icon-process-dot current"></i>
                <div class="event-process-detail"><span class="sig-event-process" ng-repeat="status in event.currentSnapshot" ng-bind="status.version+' , '+status.replicas"></span></div></span></span><span class="event-process tool-nowrap" ng-if="event.operation=='KUBERNETES'" ng-bind="event.message" hoverable-popover="hoverable-popover" content="event.message"></span><span class="txt-warning event-info" ng-show="event.eventStatus=='FAILED'" popover="{{event.message}}" popover-trigger="click" tooltip="点击打开/关闭" tooltip-placement="left">错误信息</span></li>
        </ul>
      </div>
    </tab>
    <tab heading="实例" active="tabActive[3].active" ui-sref="deployDetail.instance">
      <div class="instance-con">
        <table class="ui-table-dome instance-list">
          <thead>
            <tr>
              <th>实例名称</th>
              <th>所在主机</th>
              <th>部署版本</th>
              <th>启动时间</th>
              <th>实例状态</th>
              <th>日志</th>
              <th>容器控制台</th>
            </tr>
          </thead>
          <tbody>
            <tr ng-if="!instanceList || instanceList.length===0">
              <td colspan="7">无实例信息</td>
            </tr>
            <tr ng-repeat="ins in instanceList">
              <td ng-bind="ins.instanceName"></td>
              <td ng-bind="ins.hostIp"></td>
              <td ng-cloak="ng-cloak">version{{ins.versionId}}</td>
              <td ng-bind="vmDome.parseDate(ins.startTime)"></td>
              <td ng-bind="ins.status"></td>
              <td><a class="link-safe" ng-click="showLog(ins.instanceName,ins.containers)">查看</a></td>
              <td><a class="link-safe" ng-click="toConsole($index)">进入</a></td>
            </tr>
          </tbody>
        </table>
      </div>
    </tab>
    <tab heading="网络/访问" active="tabActive[4].active" ui-sref="deployDetail.network">
      <div class="health-con deploy-info">
        <ul class="com-list-info" ng-form="ng-form" name="healthFrom" ng-class="{'need-valid':healthNeedValid}">
          <li class="has-border"><span class="info-name">网络模式</span>
            <div class="info-content info-content-lg-height"><span class="small-info">{{showdeploy.networkMode=='HOST'?'Host':'Overlay'}}</span></div>
          </li>
          <li class="has-border"><span class="info-name">访问设置</span>
            <div class="info-content info-content-lg-height"><span class="small-info">{{showdeploy.visitSet}}</span>
              <div ng-if="showdeploy.networkMode=='DEFAULT'&amp;&amp;showdeploy.loadBalanceDrafts&amp;&amp;showdeploy.loadBalanceDrafts.length!==0">
                <div class="log-item-none-top log-item log-item-align" ng-repeat="loadbalance in showdeploy.loadBalanceDrafts">
                  <div class="line-full"><span class="log-title not-align-input">服务监听端口</span><span ng-bind="loadbalance.targetPort"></span></div>
                  <div class="line-full"><span class="log-title not-align-input"> 对外访问端口</span><span ng-bind="loadbalance.port"></span></div>
                  <div class="line-full"><span class="log-title not-align-input"> 对外访问IP</span>
                    <div class="line-element">
                      <div class="ips" ng-repeat="ips in showdeploy.loadBalanceDrafts[$index].externalIPs" ng-bind="ips" ng-if="!last"></div>
                    </div>
                  </div>
                </div>
              </div>
              <div ng-if="showdeploy.networkMode=='DEFAULT'&amp;&amp;showdeploy.innerServiceDrafts&amp;&amp;showdeploy.innerServiceDrafts.length!==0">
                <div class="log-item-none-top log-item log-item-align" ng-repeat="innerService in showdeploy.innerServiceDrafts">
                  <div class="line-full"><span class="log-title not-align-input">服务监听端口</span><span ng-bind="innerService.targetPort"></span></div>
                  <div class="line-full"><span class="log-title not-align-input"> 集群内访问端口</span><span ng-bind="innerService.port"></span></div>
                </div>
              </div>
              <div ng-if="showdeploy.networkMode=='HOST'&amp;&amp;showdeploy.exposePortNum!==0">
                <div class="log-item-none-top log-item log-item-align">
                  <div class="line-full"><span>对外暴露端口个数:&nbsp;</span><span ng-bind="showdeploy.exposePortNum"></span></div><span class="txt-prompt tool-align-input">Host网络下，系统会给每个实例分配若干个端口，用于对外服务和实例间通信。此外，在Host网络下，实例ip和宿主机ip一致。</span>
                </div>
              </div>
            </div>
          </li>
          <li><span class="info-name">内网域名</span>
            <div class="info-content info-content-lg-height"><span>{{showdeploy.serviceDnsName}}</span></div>
          </li>
        </ul>
      </div>
    </tab>
  </tabset>
</div>
<script type="text/ng-template" id="versionListModal.html">
  <div class="d-modal-header">选择版本</div>
  <form class="modal-body" name="versionFrom" ng-class="{'need-valid':needValid}">
    <ul class="modal-item">
      <li><span class="modal-label">选择Version</span>
        <div class="com-select-con modal-info" select-con="select-con">
          <button class="ui-btn ui-btn-white ui-btn-select"><i class="icon-down"></i>{{versionData.versionId?'version'+versionData.versionId:'选择Version'}}</button>
          <ul class="select-list">
            <li class="select-item" ng-repeat="version in versionList"><a ng-click="checkVersion(version.version)" ng-cloak="ng-cloak">version{{version.version}}</a></li>
          </ul>
          <input type="hidden" ng-model="versionData.versionId" name="currentVersionId" required="required"/>
          <div class="txt-error" ng-if="needValid&amp;&amp;versionFrom.currentVersionId.$invalid">请选择版本</div>
        </div>
      </li>
      <li ng-if="!stateful &amp;&amp; !isDaemonSet">
        <div class="modal-label">启动实例个数</div>
        <div class="modal-info">
          <input class="ui-input-white" ng-model="versionData.replicas" name="replicas" required="required" ng-pattern="/^[1-9]\d*$/"/>
        </div>
      </li>
    </ul>
  </form>
  <div class="modal-footer">
    <button class="ui-btn ui-btn-sm ui-btn-white" ng-click="cancel()">取消</button>
    <button class="ui-btn ui-btn-bright ui-btn-sm" ng-click="needValid=true;versionFrom.$valid&amp;&amp;submit()">确定</button>
  </div>
</script>
<script type="text/ng-template" id="createVersionModal.html">
  <div class="d-modal-header">升级版本</div>
  <div class="modal-body" style="display: table;margin: 0 auto;text-align: left;">
    <div style="margin-bottom:15px;">成功新建部署版本，本次是否升级？</div>
    <ul ng-form="ng-form" role="form" name="replicasForm" ng-class="{'need-valid':needValid}">
      <li><span class="info-name" style="margin-right:20px;">实例个数</span><span class="info-content">
          <input class="ui-input-white" style="width: 139px;" ng-model="replicas" name="replicas" required="required" ng-pattern="/^[1-9]\d*$/"/><span class="txt-error" ng-if="(needValid||replicasForm.replicas.$dirty)&amp;&amp;replicasForm.replicas.$error.pattern">必须为大于0的整数</span></span></li>
    </ul>
  </div>
  <div class="modal-footer">
    <button class="ui-btn ui-btn-sm ui-btn-white" ng-click="needValid=true;replicasForm.$valid&amp;&amp;submitUpdateVersion()">继续升级</button>
    <button class="ui-btn ui-btn-bright ui-btn-sm pull-right" type="submit" ng-click="cancel()">暂不升级</button>
  </div>
</script>
<script type="text/ng-template" id="scaleModal.html">
  <div class="d-modal-header">扩容/缩容</div>
  <div class="modal-body" style="display: table;margin: 0 auto;text-align: left;">
    <ul ng-form="ng-form" role="form" name="replicasForm" ng-class="{'need-valid':needValid}">
      <li><span class="info-name" style="margin-right:20px;width: 80px;">实例个数</span><span class="info-content">
          <input class="ui-input-white" ng-model="replicas" name="replicas" required="required" ng-pattern="/^[1-9]\d*$/" not-equal="oldReplicas"/> 个<span class="txt-error" ng-if="(needValid||replicasForm.replicas.$dirty)&amp;&amp;replicasForm.replicas.$error.pattern">必须为大于0的整数</span><span class="txt-error" ng-if="(needValid||replicasForm.replicas.$dirty)&amp;&amp;!replicasForm.replicas.$error.pattern&amp;&amp;replicasForm.replicas.$error.notEqual">不能为当前实例个数</span></span></li>
    </ul>
  </div>
  <div class="modal-footer">
    <button class="ui-btn ui-btn-sm ui-btn-white" ng-click="cancel()">取消</button>
    <button class="ui-btn ui-btn-bright ui-btn-sm pull-right" ng-click="needValid=true;replicasForm.$valid&amp;&amp;submitScale()">确定</button>
  </div>
</script>
<script type="text/ng-template" id="scaleModalForDaemonSet.html">
  <div class="d-modal-header">扩容/缩容</div>
  <div class="modal-body text-center modal-scale modal-scale-daemonset">
    <ul ng-form="ng-form" role="form" name="replicasForm" ng-class="{'need-valid':needValid}">
      <li><span class="info-name">主机标签</span>
        <div class="info-content">
          <div class="line-short">
            <div class="ui-input-white host-txt-con com-select-con" select-con="select-con" label="true">
              <ul class="selected-labels">
                <li class="select-label" ng-repeat="(label,value) in deployIns.nodeListIns.labelsInfo|search:'isSelected':true|search:'isShow':true" ng-cloak="ng-cloak">{{label}}<a class="icon-cancel" ng-click="deployIns.nodeListIns.toggleLabel(label,false)"></a></li>
                <li class="select-input">
                  <input class="line-element ui-btn-select" placeholder="选择主机标签" ng-model="labelKey.key" ng-keydown="labelKeyDown($event,labelKey.key,labelsInfoFiltered);" ng-focus="selectFocus()"/>
                </li>
              </ul>
              <ul class="select-list">
                <li ng-if="vmDome.objLength(labelsInfoFiltered)===0"><a>无相关信息</a></li>
                <li class="select-item" ng-repeat="(label,value) in labelsInfoFiltered=(deployIns.nodeListIns.labelsInfo| searchKey:labelKey.key|search:'isShow':true)"><a ng-bind="label" ng-click="deployIns.nodeListIns.toggleLabel(label,true);labelKey.key='';"></a></li>
              </ul>
            </div><span class="txt-wrap"><a class="link-safe" ng-click="deployIns.nodeListIns.showHost()">查看选中主机</a></span>
          </div>
        </div>
      </li>
    </ul>
  </div>
  <div class="modal-footer">
    <button class="ui-btn ui-btn-sm ui-btn-white" ng-click="cancel()">取消</button>
    <button class="ui-btn ui-btn-bright ui-btn-sm pull-right" ng-click="needValid=true;replicasForm.$valid&amp;&amp;submitScale()">确定</button>
  </div>
</script>